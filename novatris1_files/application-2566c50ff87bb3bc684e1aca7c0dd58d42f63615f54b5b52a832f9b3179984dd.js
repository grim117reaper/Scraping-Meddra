function setOntology(e){currentOntology=e}function setConcept(e){currentConcept=e}function getOntology(){return currentOntology}function getConcept(){return currentConcept}function refreshCache(e){cache[e]=null,queData([e],currentOntology)}function getCache(e){return null!=cache[e]?cache[e]:null}function setCache(e,t){cache[e]=t}function queData(e,t){return currentOntology=t,!1}function preFetchData(n,o,a){var e={success:function(e){var t=e.responseText;tabData=t.split("|||"),setCache(n,tabData),++queIndex<que.length&&thread==a?preFetchData(que[queIndex],o,a):queIndex>=que.length&&(que=new Array)},failure:function(){}};null==getCache(n)?YAHOO.util.Connect.asyncRequest("GET","/"+o+"/"+n+"?callback=load",e):++queIndex<que.length&&thread==a?preFetchData(que[queIndex],o,a):queIndex>=que.length&&(que=new Array)}function toggleHide(e,t){if(toggle=!0,element=document.getElementById(e),""==element.style.display&&(toggle=!1),null!=t&&""!=t){elements=document.getElementsByName(t);for(var n=0;n<elements.length;n++)elements[n].style.display="none"}toggle?"none"==element.style.display&&(element.style.display=""):element.style.display="none"}function newProposal(e){document.getElementById("subject").value="Proposal For Change",document.getElementById("comment").value=e,selectBox=document.getElementById("margin_note_note_type");for(var t=0;t<selectBox.options.length;t++)option=selectBox.options[t],5!=option.value&&(option.disabled=!0),5==option.value&&(option.selected=!0)}function newNote(){toggleHide("commentForm","forms")}function compare(e){oldValue=document.getElementById("oldValue").innerHTML,element=document.getElementById("note_value"+e),target=document.getElementById("note_text"+e);var t=dmp.diff_main(oldValue,element.value);dmp.diff_cleanupSemantic(t),target.innerHTML=dmp.diff_prettyHtml(t)}function hide(e){document.getElementById(e).style.display="none"}function unhide(e){document.getElementById(e).style.display=""}function buildWait(){YAHOO.namespace("wait.container"),YAHOO.wait.container.wait=new YAHOO.widget.Panel("wait",{width:"240px",fixedcenter:!0,close:!1,draggable:!1,zindex:4,modal:!0,visible:!1}),YAHOO.wait.container.wait.setHeader("Loading, please wait..."),YAHOO.wait.container.wait.setBody('<img src="http://us.i1.yimg.com/us.yimg.com/i/us/per/gr/gp/rel_interstitial_loading.gif" />'),YAHOO.wait.container.wait.render(document.body)}function buildTabWait(){YAHOO.namespace("tabwait.container"),YAHOO.tabwait.container.wait=new YAHOO.widget.Panel("tabwait",{width:"240px",fixedcenter:!0,close:!1,draggable:!1,zindex:4,modal:!0,visible:!1}),YAHOO.tabwait.container.wait.setHeader("Building Tree, please wait..."),YAHOO.tabwait.container.wait.setBody('<img src="http://us.i1.yimg.com/us.yimg.com/i/us/per/gr/gp/rel_interstitial_loading.gif" />'),YAHOO.tabwait.container.wait.render(document.body)}function buildSearchWait(){YAHOO.namespace("wait.container"),YAHOO.wait.container.wait=new YAHOO.widget.Panel("wait",{width:"240px",fixedcenter:!0,close:!1,draggable:!1,zindex:4,modal:!0,visible:!1}),YAHOO.wait.container.wait.setHeader("Searching, please wait..."),YAHOO.wait.container.wait.setBody('<img src="http://us.i1.yimg.com/us.yimg.com/i/us/per/gr/gp/rel_interstitial_loading.gif" />'),YAHOO.wait.container.wait.render(document.body)}function toggleSelected(e){var t=1;for(nullCount=0;nullCount<20;){if(null!=tree.getNodeByIndex(t)){if("ygtvlabel-selected"==tree.getNodeByIndex(t).labelStyle){tree.getNodeByIndex(t).labelStyle="ygtvlabel";break}}else nullCount++;t++}e.labelStyle="ygtvlabel-selected"}function buildTabs(){tabs=new YAHOO.widget.TabView("tabframe");var e=new Ext.SplitBar("dragSpot","leftbar",Ext.SplitBar.HORIZONTAL,Ext.SplitBar.LEFT);e.setAdapter(new Ext.SplitBar.AbsoluteLayoutAdapter("container")),e.minSize=100,e.maxSize=400,e.animate=!0,e.on("moved",splitterMoved)}function splitterMoved(){Ext.get("centerContent"),Ext.get("tabframe"),Ext.get("leftbar")}function resetNoteForm(e){document.getElementById("note_subject"+e).value="",document.getElementById("note_comment"+e).value="",document.getElementById("noteParent"+e).value=""}function buildEditor(e){YAHOO.util.Dom,YAHOO.util.Event;(myEditor=new YAHOO.widget.SimpleEditor("note_comment"+e,{height:"300px",width:"522px",dompath:!1})).render()}function saveNote(){myEditor.saveHTML(),myEditor.destroy()}function destroyEditor(){myEditor.clearEditorDoc(),myEditor.destroy()}function updateOntologyList(e){if(list=document.getElementById("ontologieslist"),e.checked){var t=document.createElement("LI"),n=document.createElement("INPUT");n.type="hidden",n.value=1,n.name=e.name,n.id="hid_"+e.nextSibling.nodeValue,t.id="id_"+e.nextSibling.nodeValue,t.innerHTML=e.nextSibling.nodeValue,list.appendChild(t),list.appendChild(n),e.parentNode.innerHTML=e.parentNode.innerHTML.replace(">","checked >")}else list.removeChild(document.getElementById("id_"+e.nextSibling.nodeValue)),list.removeChild(document.getElementById("hid_"+e.nextSibling.nodeValue)),e.parentNode.innerHTML=e.parentNode.innerHTML.replace("checked","")}function hover_on_BG(e){e.firstChild.checked||(e.style.background="#DFDFDF")}function hover_off_BG(e){e.firstChild.checked||(e.style.background="white")}function toggleBG(e,t){e.firstChild.checked,e.style.backgroundColor=t}function updateContent(){document.getElementById("ontologies").innerHTML=Dialog.dialog.getContent().innerHTML}function ajaxForm(e,t,n){var o=[];return jQuery(e).find(":input").each(function(){"checkbox"==this.type||"radio"==this.type&&this.checked?o.push(this.name+"="+escape(this.value)):"checkbox"!=this.type&&"radio"!=this.type&&o.push(this.name+"="+escape(this.value))}),jQuery.post(e.action,o.join("&"),function(e){jQuery(t).html(e),n&&n(),tb_init("a.thickbox, area.thickbox, input.thickbox")}),!1}function update_tab(e,t){jQuery.get("/tab/update/"+e+"/"+t)}function remove_tab(e,t,n){jQuery.get("/tab/remove/"+t,function(){n?window.location="/ontologies":jQuery("#tab"+t).remove()})}function selectTab(e,t){nav=document.getElementById(e);for(var n=0;n<nav.childNodes.length;n++)nav.childNodes[n].className="";document.getElementById(t).className="selected"}function BP_queryString(){for(var e=window.location.search.substr(1).split("&"),t={},n=0;n<e.length;++n){var o=e[n].split("=");2==o.length&&(t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," ")))}return t}function bpPopWindow(e){e.preventDefault();var t=jQuery(e.currentTarget).attr("href"),n=null!=t.match(/\?/)?"&pop=true":"?pop=true",o=800,a=600;"undefined"!=typeof e.data&&(e.data.hasOwnProperty("w")&&(o=e.data.w),e.data.hasOwnProperty("h")&&(a=e.data.h)),t=null!=t.match(/#/)?[t.slice(0,t.indexOf("#")),n,t.slice(t.indexOf("#"))].join(""):t+n;var r=window.screenLeft!=undefined?window.screenLeft:window.screenX,i=window.screenTop!=undefined?window.screenTop:window.screenY,s=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width)/2-o/2+r,l=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height)/2-a/2+i,c=window.open(t,"bp_popup_window","scrollbars=yes, width="+o+", height="+a+", top="+l+", left="+s);window.focus&&c.focus()}function loadingAnimation(e){var t=jQuery(e).text(),n=0;return setInterval(function(){jQuery(e).append("."),4==++n&&($(e).html(t),n=0)},500)}function getAjaxContent(){$(".get_via_ajax").each(function(){void 0===$(this).attr("getting_content")&&($(this).parent().load($(this).attr("href")),$(this).attr("getting_content",!0))}),setTimeout(getAjaxContent,500)}function pageUsesTreeView(){var e=!0,t=currentPathArray();if("ontologies"!==t[0])e=!1;else if(2!==t.length||"new"===t[1])e=!1;else{var n=jQuery(document).data().bp.ont_viewer.metadata_only;null!=n&&"true"===n&&(e=!1)}return e}function wrapupTabChange(e){jQuery.unblockUI(),tb_init("a.thickbox, area.thickbox, input.thickbox"),jQuery(document).trigger("visualize_tab_change",[{tabType:e}]),jQuery(document).trigger("tree_changed")}function setCacheCurrent(){var e=[];"undefined"!=typeof notesTable&&null!==notesTable&&0!==notesTable.length&&(e.notes_table_data=notesTable.fnGetData()),resetNotesTable(),e[0]=jQuery("#visualization_content").html(),e[1]=jQuery("#details_content").html(),e[2]=jQuery("#notes_content").html(),e[3]=jQuery("#mappings_content").html(),e[5]=jQuery("#note_count").html(),e[6]=jQuery("#mapping_count").html(),setCache(getConcept(),e)}function resetNotesTable(){jQuery(".notes_table_container div[class^=dataTables_]").remove()}function insertNotesTable(e){jQuery(".notes_table_container").append(jQuery("#notes_list_table_clone").clone()),jQuery(".notes_table_container #notes_list_table_clone").attr("id","notes_list_table"),wireTableWithData(jQuery("#notes_list_table"),e)}function initClassTree(){simpleTreeCollection=jQuery(".simpleTree").simpleTree({autoclose:!1,drag:!1,animate:!0,timeout:2e4,afterClick:function(e){History.pushState({p:"classes",conceptid:jQuery(e).children("a").attr("id")},jQuery.bioportal.ont_pages.classes.page_name+" | "+jQuery(document).data().bp.ont_viewer.org_site,jQuery(e).children("a").attr("href"))},afterAjaxError:function(e){simpleTreeCollection[0].option.animate=!1,simpleTreeCollection.get(0).nodeToggle(e.parent()[0]),0==e.parent().children(".expansion_error").length&&e.parent().append("<span class='expansion_error'>Error, please try again"),simpleTreeCollection[0].option.animate=!0},beforeAjax:function(e){e.parent().children(".expansion_error").remove()}}),setConcept(jQuery(document).data().bp.ont_viewer.concept_id),setOntology(jQuery(document).data().bp.ont_viewer.ontology_id),jQuery("#sd_content").scrollTo(jQuery("a.active")),setCacheCurrent(),jQuery(".too_many_children_override").live("click",function(e){e.preventDefault();var t=jQuery(this).closest("ul");t.html("<img src='/images/tree/spinner.gif'>"),jQuery.ajax({url:jQuery(this).attr("href"),context:t,success:function(e){this.html(e),simpleTreeCollection.get(0).setTreeNodes(this)},error:function(){this.html("<div style='background: #eeeeee; padding: 5px; width: 80%;'>Problem getting children. <a href='"+jQuery(this).attr("href")+"' class='too_many_children_override'>Try again</a></div>")}})})}function nodeClicked(n){if(setCacheCurrent(),notesTable=null,0!=n){setConcept(n);var e=0==n.indexOf("http://")||0==n.indexOf(encodeURIComponent("http://"))?"?conceptid="+n:"/"+n,o=jQuery("#bd_content div.tabs li.selected a").attr("href").slice(1);if(jQuery("a.class-permalink").data("current-purl",jQuery(document).data().bp.ont_viewer.purl_prefix+e),null!=getCache(n)){var t=getCache(n);jQuery("a.active").removeClass("active"),jQuery(document.getElementById(n)).addClass("active"),jQuery("#visualization_content").html(t[0]),jQuery("#details_content").html(t[1]),jQuery("#notes_content").html(t[2]),jQuery("#mappings_content").html(t[3]),jQuery("#note_count").html(t[5]),jQuery("#mapping_count").html(t[6]),insertNotesTable(t.notes_table_data),wrapupTabChange(o)}else jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" alt="Spinner" /> Loading Class...</h1>',showOverlay:!1}),jQuery.get("/ajax_concepts/"+jQuery(document).data().bp.ont_viewer.ontology_id+"/?conceptid="+n+"&callback=load",function(e){var t=e.split("|||");jQuery("#visualization_content").html(t[0]),jQuery("#details_content").html(t[1]),jQuery("#notes_content").html(t[2]),jQuery("#mappings_content").html(t[3]),jQuery("#note_count").html(t[5]),jQuery("#mapping_count").html(t[6]),"resource_index"==o&&callTab("resource_index","/resource_index/resources_table?conceptids="+jQuery(document).data().bp.ont_viewer.ontology_id+"/"+encodeURIComponent(getConcept())),setCache(n,t),wrapupTabChange(o)})}else alert("Sorry, we cannot display all the classes at this level in the hierarchy because there are too many of them. Please select another class or use the Search to find a specific concept in this ontology")}function placeTreeView(e){0==jQuery("#sd_content").length?setTimeout(function(){placeTreeView(e)},500):(document.getElementById("sd_content").innerHTML=e,initClassTree(),classesPaneSplitter=Split(["div#bd_content .sidebar","div#bd_content .cls-info-container"],{elementStyle:function(e,t,n){return{"flex-basis":"calc("+t+"% - "+n+"px)"}},gutterStyle:function(e,t){return{"flex-basis":t+"px"}},gutterSize:10,direction:"horizontal",sizes:[30,70],cursor:"col-resize"}))}function getTreeView(){jQuery.ajax({url:"/ajax/classes/treeview?ontology="+jQuery(document).data().bp.ont_viewer.ontology_id+"&conceptid="+encodeURIComponent(jQuery(document).data().bp.ont_viewer.concept_id),success:function(e){placeTreeView(e)},error:function(){jQuery.get("/ajax/classes/treeview?ontology="+jQuery(document).data().bp.ont_viewer.ontology_id+"&conceptid=root",function(e){placeTreeView("<div class='tree_error'>Displaying the path to this class has taken too long. You can browse classes below.</div>"+e)})},timeout:15e3})}function bp_ont_link(e){return"/ontologies/"+e}function bp_cls_link(e,t){return bp_ont_link(t)+"?p=classes&conceptid="+encodeURIComponent(e)}function get_link_for_cls_ajax(e,t){return"<a class='cls4ajax'"+(" data-cls='"+e+"' ")+(" data-ont='"+t+"' ")+"href='"+bp_cls_link(e,t)+"'>"+e+"</a>"}function get_link_for_ont_ajax(e){return"<a class='ont4ajax'"+(" data-ont='"+e+"' ")+"href='"+bp_ont_link(e)+"'>"+e+"</a>"}function displayTree(e){jQuery(document).trigger("classes_tab_visible");var t,n=e.conceptid,o=getConceptLinkEl(n),a=jQuery(document).data().bp.ont_viewer.ontology_id,r=(jQuery(document).data().bp.ont_viewer.ontology_version_id,jQuery(document).data().bp.ont_viewer.ontology_name),i=jQuery(document).data().bp.ont_viewer.org_site,s=jQuery(document).data().bp.ont_viewer.concept_id;jQuery(document).data().bp.ont_viewer.content_section,jQuery(document).data().bp.ont_viewer.concept_param,jQuery(document).data().bp.ont_viewer.concept_name,jQuery(document).data().bp.ont_viewer.metadata_only,jQuery(document).data().bp.ont_viewer.current_purl,jQuery(document).data().bp.ont_viewer.purl_prefix,jQuery(document).data().bp.ont_viewer.concept_name_title;if(void 0===n||n==s)return""!==s&&History.replaceState({p:"classes",conceptid:s},jQuery.bioportal.ont_pages.classes.page_name+" | "+i,"?p=classes&conceptid="+s),void jQuery.unblockUI();var l=void 0===n?"":"&conceptid="+n;if(void 0!==n){if(t=null==o.html()?"":" - "+o.html().trim().replace(/<(?:.|\n)*?>/gm,""),jQuery.bioportal.ont_pages.classes.html,jQuery.bioportal.ont_pages.classes=new jQuery.bioportal.OntologyPage("classes","/ontologies/"+a+"?p=classes"+l,"Problem retrieving classes",r+t+" - Classes","Classes"),"undefined"!=typeof e.suid&&"jump_to"===e.suid)if(jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" /> Loading Class...</h1>',showOverlay:!1}),!0===e.flat)if(jQuery("li#bp_fake_root").length&&(jQuery("li#bp_fake_root").remove(),jQuery("#non_fake_tabs").show(),jQuery("#fake_tabs").hide()),null==getCache(e.conceptid)){var c=jQuery("div#sd_content ul.simpleTree li.root ul");c.children().remove(),jQuery(c).append('<li id="'+e.conceptid+'"><a href="/ontologies/'+a+"/?p=classes&conceptid="+e.conceptid+'">'+e.label+"</a></li>"),jQuery(c).children(".line").remove(),jQuery(c).children(".line-last").remove(),simpleTreeCollection.get(0).setTreeNodes(c),nodeClicked(e.conceptid),jQuery("a.active").removeClass("active"),getConceptLinkEl(n).children("a").addClass("active"),jQuery("#search_box").val("")}else nodeClicked(e.conceptid),jQuery("#search_box").val("");else jQuery.bioportal.ont_pages.classes.retrieve_and_publish(),getConceptLinkEl(n);else jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" /> Loading Class...</h1>',showOverlay:!1}),null!==document.getElementById(n)?(jQuery.bioportal.ont_pages.classes.published=!0,nodeClicked(n)):jQuery.bioportal.ont_pages.classes.retrieve_and_publish();t=null==getConceptLinkEl(n).html()?"":" - "+getConceptLinkEl(n).html().trim().replace(/<(?:.|\n)*?>/gm,""),jQuery.bioportal.ont_pages.classes.page_name=r+t+" - Classes",document.title=jQuery.bioportal.ont_pages.classes.page_name+" | "+i}else t=null==getConceptLinkEl(n).html()?"":" - "+getConceptLinkEl(n).html().trim().replace(/<(?:.|\n)*?>/gm,""),jQuery.bioportal.ont_pages.classes=new jQuery.bioportal.OntologyPage("classes","/ontologies/"+a+"?p=classes","Problem retrieving classes",r+t+" - Classes","Classes"),jQuery.bioportal.ont_pages.classes.retrieve_and_publish();void 0!==n&&(s=n)}function getConceptLinkEl(e){var t=document.getElementById(e);return jQuery(t)}function showOntologyContent(e){jQuery.bioportal.ont_pages[e].publish(),jQuery("#ont-"+e+"-tab").tab("show")}function setupReviewFacebox(){jQuery("a.create_review").attr("rel","facebox[.facebox_review]"),jQuery("a.create_review").facebox()}function setupReviewFaceboxSizing(){jQuery(document).bind("afterReveal.facebox",function(){jQuery("div.facebox_review").parents("div#facebox").width("850px"),jQuery("div.facebox_review").width("820px"),jQuery("div.facebox_review").parents("div#facebox").css("max-height",jQuery(window).height()-2*(jQuery("#facebox").offset().top-jQuery(window).scrollTop())+"px"),jQuery("div.facebox_review").parents("div#facebox").centerElement()})}function getUser(){return jQuery(document).data().bp.user}function setupNotesFacebox(){jQuery("a.notes_list_link").attr("rel","facebox[.facebox_note]"),jQuery("a.notes_list_link").each(function(){jQuery(this).data().faceboxInit||(jQuery(this).facebox(),jQuery(this).data().faceboxInit=!0)})}function setupNotesFaceboxSizing(){jQuery(document).bind("afterReveal.facebox",function(){jQuery("div.facebox_note").parents("div#facebox").width("850px"),jQuery("div.facebox_note").width("820px"),jQuery("div.facebox_note").parents("div#facebox").css("max-height",jQuery(window).height()-2*(jQuery("#facebox").offset().top-jQuery(window).scrollTop())+"px"),jQuery("div.facebox_note").parents("div#facebox").centerElement()})}function bindAddCommentClick(){jQuery("a.add_comment").live("click",function(){addCommentBox(jQuery(this).attr("data-parent-id"),jQuery(this).attr("data-parent-type"),this)})}function bindAddProposalClick(){jQuery("a.add_proposal").live("click",function(){addProposalBox(jQuery(this).attr("data-parent-id"),jQuery(this).attr("data-parent-type"),this)})}function bindReplyClick(){jQuery("a.reply_reply").live("click",function(){addReplyBox(this),jQuery(this).hide()})}function bindReplyCancelClick(){jQuery(".reply .cancel, .create_note_form .cancel").live("click",function(){removeReplyBox(this)})}function bindProposalChange(){jQuery(".create_note_form .proposal_type").live("change",function(){var e=jQuery(this);proposalFields(e.val(),e.parent().children(".proposal_container"))})}function bindReplySaveClick(){jQuery(".reply .save, .create_note_form .save").live("click",function(){var e=getUser(),t=jQuery(this).data("parent_id"),n=jQuery(this).data("parent_type"),o=this,a=jQuery(this).closest(".reply_box").children(".reply_body").val(),r=subjectForNote(o),i=jQuery(document).data().bp.ont_viewer.ontology_id;jQuery(o).parent().children(".reply_status").html(""),"class"===n&&(t={"class":t,ontology:i}),jQuery.ajax({type:"POST",url:"/notes",data:{parent:t,type:n,subject:r,body:a,proposal:proposalMap(o),creator:e.id},success:function(e){var t=e,n=e[1];n&&400<=n?displayError(o):(addNoteOrReply(o,t),removeReplyBox(o))},error:function(){displayError(o)}})})}function validateReply(){}function validateNote(){}function validateProposal(){}function addCommentBox(e,t,n){var o=jQuery(n).parents(".notes_list_container").children(".create_note_form"),a=jQuery("<input>").attr("type","text").attr("placeholder","Subject").addClass("comment_subject").add("<br>").add(commentForm(e,t)),r=jQuery("<div>").addClass("reply_box").append(a);o.html(r),o.show()}function addProposalBox(e,t,n){var o,a=jQuery(n).parents(".notes_list_container").children(".create_note_form"),r=jQuery("<div>").addClass("reply_box"),i=jQuery("<select>").addClass("proposal_type");for(var s in NOTES_PROPOSAL_TYPES)i.append(jQuery("<option>").attr("value",s).html(NOTES_PROPOSAL_TYPES[[s]]));r.html("Proposal type: "),r.append(i),r.append("<br/>"),o=jQuery("<div>").addClass("proposal_container"),proposalFields(Object.keys(NOTES_PROPOSAL_TYPES).shift(),o),r.append(o),r.append(jQuery("<div>").addClass("proposal_buttons").append(commentButtons(e,t))),a.html(r),a.show()}function addNoteOrReply(e,t){"http://data.bioontology.org/metadata/Note"===t.type?addNote(e,t):"http://data.bioontology.org/metadata/Reply"===t.type&&addReply(e,t)}function addNote(e,t){var n=getUser(),o=t.id.split("/").pop(),a=generateNoteLink(o,t),r=jQuery("<div>").append(a).html(),i=t.created.split("T")[0],s="",l=getNoteType(t),c=[s,r,t.subject,"false",n.username,l,"",i];if(0<jQuery(e).closest("#notes_content").length){var u=jQuery("<tr>");u.append(jQuery("<td>").html(generateNoteLink("concept_"+o,t))),u.append(jQuery("<td>").html(n.username)),u.append(jQuery("<td>").html(l)),u.append(jQuery("<td>").html(i)),jQuery("table.concept_notes_list").prepend(u),jQuery("#note_count").html(parseInt(jQuery("#note_count").html())+1),jQuery("a#concept_"+o).facebox()}"undefined"!=typeof ontNotesTable&&ontNotesTable.fnAddData(c),jQuery("a#"+o).facebox()}function addReply(e,t){var n=getUser(),o=jQuery("<div>").addClass("reply"),a=jQuery("<div>").addClass("reply_author").html("<b>"+n.username+"</b> seconds ago"),r=jQuery("<div>").addClass("reply_body").html(t.body),i=jQuery("<div>").addClass("reply_meta");i.append(jQuery("<a>").addClass("reply_reply").attr("data-parent-id",t.id).attr("href","#reply").html("reply")),o.append(a).append(r).append(i),jQuery(e).closest("div.reply").children(".discussion").children(".discussion_container").prepend(o)}function addReplyBox(e){var t=commentForm(jQuery(e).attr("data-parent-id"),jQuery(e).attr("data-parent-type"));jQuery(e).closest("div.reply").children("div.reply_meta").append(jQuery("<div>").addClass("reply_box").html(t))}function removeReplyBox(e){jQuery(e).closest("div.reply").children(".reply_meta").children("a.reply_reply").show(),jQuery(e).closest("div.reply").children(".reply_meta").children(".reply_box").remove(),jQuery(e).closest(".create_note_form").html("")}function commentForm(e,t){return commentTextArea().add(commentButtons(e,t))}function commentTextArea(){return jQuery("<textarea>").addClass("reply_body").attr("rows","1").attr("cols","1").attr("name","text").attr("tabindex","0").attr("placeholder","Comment").css({width:"500px",height:"100px"}).add("<br>")}function commentButtons(e,t){var n=jQuery("<button>").attr("type","submit").attr("onclick","").data("parent_id",e).data("parent_type",t).addClass("save").html("save"),o=jQuery("<button>").attr("type","button").attr("onclick","").addClass("cancel").html("cancel"),a=jQuery("<span>").addClass("reply_status").css({color:"red",paddingLeft:"5px"});return n.add(o).add(a)}function appendField(e,t,n){jQuery.browser.msie&&parseInt(jQuery.browser.version)<10&&(n.append(jQuery("<span>").css("font-weight","bold").html(t)),n.append("<br/>")),n.append(jQuery("<input>").attr("type","text").attr("id",e).attr("placeholder",t)),n.append("<br/>")}function proposalFields(e,t){t.html(""),appendField("reasonForChange","Reason for change",t),"ProposalChangeHierarchy"===e?(appendField("newTarget","New target",t),appendField("oldTarget","Old target",t),appendField("newRelationshipType","Relationship type",t)):"ProposalChangeProperty"===e?(appendField("propertyId","Property id",t),appendField("newValue","New value",t),appendField("oldValue","Old Value",t)):"ProposalNewClass"===e&&(appendField("classId","Class id",t),appendField("label","Label",t),appendField("synonym","Synonym",t),appendField("definition","Definition",t),appendField("parent","Parent",t))}function proposalMap(e){var t=jQuery(e).parents(".notes_list_container").children(".create_note_form"),o=["synonym","definition","newRelationshipType"],a={};return a.type=t.find(".proposal_type").val(),console.log(t.find(".proposal_container input")),t.find(".proposal_container input").each(function(){var e=jQuery(this),t=e.attr("id"),n=0<=jQuery.inArray(t,o)?e.val().split(","):e.val();a[t]=n}),a}function subjectForNote(e){var t=jQuery(e).closest(".reply_box").children(".comment_subject").val(),n=jQuery("input#reasonForChange");return(void 0===t||0===t.length&&0<n.length)&&(t=NOTES_PROPOSAL_TYPES[$(".proposal_type").val()]+": "+n.val()),t}function generateNoteLink(e,t){return jQuery("<a>").addClass("ont_notes_list_link").addClass("notes_list_link").attr("href","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"/notes/"+encodeURIComponent(t.id)).attr("id",e).html(t.subject)}function getNoteType(e){return"undefined"!=typeof e.proposal?NOTES_PROPOSAL_TYPES[e.proposal[0]]:"Comment"}function subscribeToNotes(e){var t=jQuery(e).attr("data-bp_ontology_id"),o=jQuery(e).attr("data-bp_is_subbed"),n=jQuery(e).attr("data-bp_user_id");jQuery(".notes_sub_error").html(""),jQuery(".notes_subscribe_spinner").show(),jQuery.ajax({type:"POST",url:"/subscriptions?user_id="+n+"&ontology_id="+t+"&subbed="+o,dataType:"json",success:function(){jQuery(".notes_subscribe_spinner").hide();var e="true"==o?"false":"true";jQuery("a.subscribe_to_notes").attr("data-bp_is_subbed",e);var t=jQuery("a.subscribe_to_notes span.ui-button-text").html(),n=t.match("Unsubscribe")?t.replace("Unsubscribe","Subscribe"):t.replace("Subscribe","Unsubscribe");jQuery("a.subscribe_to_notes span.ui-button-text").html(n)},error:function(){jQuery(".notes_subscribe_spinner").hide(),jQuery(".notes_sub_error").html("Problem subscribing to emails, please try again")}})}function determineHTTPS(e){return e.replace("http:","https:"==document.location.protocol?"https:":"http:")}function bp_internal_formComplete_formatItem(e){var t,n=this.extraParams.input,o=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),a=jQuery(n).val().replace(o,"\\$&").split(" ").join("|"),r=new RegExp("("+a+")","gi"),i="",s="350px",l=jQuery(n).attr("class").split(" ");jQuery(l).each(function(){if(0===this.indexOf("bp_internal_form_complete")){var e=this.split("-");t=e[1]}});var c=jQuery(n).attr("data-bp_include_definitions");"true"===c?s="150px":"all"==t&&(s="320px");var u=e[2],d=e[0];if("all"!==t){var p=e[7];"true"===c&&(i+="<div class='result_definition'>"+truncateText(decodeURIComponent(p.replace(/\+/g," ")),75)+"</div>"),i+="<div class='result_class' style='width: "+s+";'>"+d.replace(r,"<b><span class='result_class_highlight'>$1</span></b>")+"</div>",i+="<div class='result_type' style='overflow: hidden;'>"+u+"</div>"}else{var h=e[7];p=e[9];i+="<div class='result_class' style='width: "+s+";'>"+d.replace(r,"<b><span class='result_class_highlight'>$1</span></b>")+"</div>","true"===c&&(i+="<div class='result_definition'>"+truncateText(decodeURIComponent(p.replace(/\+/g," ")),75)+"</div>"),i+="<div> <div class='result_type'>"+u+"</div><div class='result_ontology' style='overflow: hidden;'>"+truncateText(h,35)+"</div></div>"}return i}function bp_internal_formComplete_setup_functions(){jQuery("input[class*='bp_internal_form_complete']").each(function(){var e,t,n,o=this.className.split(" "),a=jQuery(this).attr("data-bp_search_branch");void 0===a&&(a="");var r=jQuery(this).attr("data-bp_include_definitions");void 0===r&&(r="");var i=jQuery(this).attr("data-bp_objecttypes");void 0===i&&(i=""),jQuery(o).each(function(){0===this.indexOf("bp_internal_form_complete")&&(e=this.split("-"),t=e[1],n=e[2])}),"all"==t&&(t="");var s={input:this,target_property:n,subtreerootconceptid:encodeURIComponent(a),includedefinitions:r,objecttypes:i,id:BP_INTERNAL_ONTOLOGIES},l=450;r&&(l+=275),""===t&&(l+=200),s.id=t,jQuery(this).bp_autocomplete(BP_INTERNAL_SEARCH_SERVER+"/search/json_search/",{extraParams:s,lineSeparator:"~!~",matchSubset:0,mustMatch:!0,sortRestuls:!1,minChars:3,maxItemsToShow:20,cacheLength:-1,width:l,onItemSelect:bpFormSelect,formatItem:bp_internal_formComplete_formatItem});var c="";null==document.getElementById(jQuery(this).attr("name")+"_bioportal_concept_id")&&(c+="<input type='hidden' id='"+jQuery(this).attr("name")+"_bioportal_concept_id'>"),null==document.getElementById(jQuery(this).attr("name")+"_bioportal_ontology_id")&&(c+="<input type='hidden' id='"+jQuery(this).attr("name")+"_bioportal_ontology_id'>"),null==document.getElementById(jQuery(this).attr("name")+"_bioportal_full_id")&&(c+="<input type='hidden' id='"+jQuery(this).attr("name")+"_bioportal_full_id'>"),null==document.getElementById(jQuery(this).attr("name")+"_bioportal_preferred_name")&&(c+="<input type='hidden' id='"+jQuery(this).attr("name")+"_bioportal_preferred_name'>"),jQuery(this).after(c)})}function bpFormSelect(e){var t=this.extraParams.input;switch(this.extraParams.target_property){case"uri":jQuery(t).val(e.extra[3]);break;case"shortid":jQuery(t).val(e.extra[0]);break;case"name":jQuery(t).val(e.extra[4])}jQuery("#"+jQuery(t).attr("name")+"_bioportal_concept_id").val(e.extra[0]),jQuery("#"+jQuery(t).attr("name")+"_bioportal_ontology_id").val(e.extra[2]),jQuery("#"+jQuery(t).attr("name")+"_bioportal_full_id").val(e.extra[3]),jQuery("#"+jQuery(t).attr("name")+"_bioportal_preferred_name").val(e.extra[4])}function truncateText(e,t){void 0!==t&&""!=t||(t=70);var n="...";if($.trim(e).length<=t)return e;n.length,jQuery("<div>"),jQuery("<div>").html(e).hide();var o=(e=e.replace(/^ /,"")).slice(0,t);return o=$("<div/>").text(o).html(),o+="<span class='expand_icon'><b>"+n+"</b></span>",o+="<span class='long_text'>"+e.slice(t,e.length)+"</span>"}function updateMappingDeletePermissions(){var e=jQuery("#delete_mappings_permission");0===e.length?(jQuery("#delete_mappings_button").hide(),jQuery(".delete_mappings_column").hide(),jQuery("input[name='delete_mapping_checkbox']").prop("disabled",!0)):(e.hide(),e.is(":checked")?(jQuery("#delete_mappings_button").show(),jQuery(".delete_mappings_column").show(),jQuery("input[name='delete_mapping_checkbox']").prop("disabled",!1)):(jQuery("#delete_mappings_button").hide(),jQuery(".delete_mappings_column").hide(),jQuery("input[name='delete_mapping_checkbox']").prop("disabled",!0))),jQuery("input[name='delete_mapping_checkbox']").prop("checked",!1)}function getClassDetails(){var e=jQuery("#map_to_bioportal_ontology_id").val(),t=jQuery("#map_to_bioportal_full_id").val();jQuery("#map_to_concept_details_table").html('<img style="padding: 5px;" src="/assets/spinners/spinner_000000_16px-4f45a5c270658c15e01139159c3bfca130a7db43c921af9fe77dc0cce05132bf.gif" alt="Spinner 000000 16px" />'),jQuery("#map_to_concept_details_table").load("/ajax/class_details?ontology="+encodeURIComponent(e)+"&styled=false&conceptid="+encodeURIComponent(t))}function resetAutocompleter(e){var t=jQuery("#map_to");t[0].autocompleter.flushCache(),t[0].autocompleter.getExtraParams().id=e,t.val("")}function resetMappingUIWithFacebox(){jQuery("#mappings_content a[rel*=facebox]").facebox(),resetMappingUI()}function resetMappingUI(){jQuery("#map_from_bioportal_full_id").val(jQuery("#sd_content a.active").attr("id")),jQuery("#map_to_concept_details").html(""),jQuery("#create_mapping_success_messages").html(""),jQuery("a.link_button, input.link_button").button(),updateMappingDeletePermissions()}function Analytics(){this.track=function(e,t,n,o){n.segment=e,n.analytics_action=t,jQuery.ajax({url:"/analytics",data:n,type:"POST",timeout:100,success:function(){"function"==typeof o&&o()},error:function(){"function"==typeof o&&o()}})}}function SearchAnalytics(){this.bindTracker=function(){jQuery("#search_results_container div.class_link a").live("click",function(e){e.preventDefault();var t=jQuery(this).attr("href"),n=(new SearchAnalytics).linkInformation(this);(new Analytics).track("search","result_clicked",n,function(){window.location.href=t})})},this.linkInformation=function(e){var t={},n=0,o=jQuery("#search_results div.search_result").index(jQuery(e).closest(".search_result"))+1;if(e=jQuery(e),t.ontology_clicked=e.closest(".search_result").attr("data-bp_ontology_id"),0===e.closest(".additional_results").length?t.position=o:t.position=e.closest(".additional_results").children(".search_result_additional").index(e.closest(".search_result_additional"))+1,t.additional_result=0<e.closest(".additional_results").length,1<t.position||!0===t.additional_result){var a=jQuery("#search_results div.search_result");for(t.higher_ontologies=[];n<o-1;)t.higher_ontologies.push(jQuery(a[n]).attr("data-bp_ontology_id")),n+=1}return t.concept_id=e.attr("data-bp_conceptid"),t.query=jQuery("#search_keywords").val(),t.exact_match=e.attr("data-exact_match"),t}}function UserIntentionSurvey(e){if(void 0!==e){var t=this
;t.surveyName=e.surveyName,t.forwardOnSubmit=1==e.forwardOnSubmit,t.forwardToUrl=e.forwardToUrl,t.submitForAnalytics=0!=e.submitForAnalytics,t.tempDisableLength=e.tempDisableLength||7,t.surveyEnabled=""!=t.surveyName,t.timeoutKey="user_survey_timeout_"+t.surveyName,t.bindTracker=function(){return!("true"===BP_getCookie(t.timeoutKey)||!t.surveyEnabled)&&(!(2<window.location.pathname.split("/").length)&&(jQuery.get("/home/user_intention_survey",function(e){jQuery.facebox(e,"user_intention_survey")}),jQuery(document).live("afterClose.facebox",function(){jQuery("#dont_show_again").is(":checked")?t.disablePermanently():t.disableTemporarily(),t.submitForAnalytics&&t.submitSurvey()}),jQuery("#intention_submit").live("click",function(){t.forwardToUrl?t.disablePermanentlyAndForward(t.forwardToUrl):t.closeDialog()}),jQuery("#intention_remind").live("click",function(){t.closeDialog()}),void jQuery("#intention_close").live("click",function(){t.closeDialog()})))},t.disablePermanentlyAndForward=function(e){BP_setCookie(t.timeoutKey,!0,{days:365}),setTimeout(function(){document.location=e},500)},t.disablePermanently=function(){BP_setCookie(t.timeoutKey,!0,{days:365})},t.disableTemporarily=function(){BP_setCookie(t.timeoutKey,!0,{days:t.tempDisableLength})},t.closeDialog=function(){jQuery(document).trigger("close.facebox")},t.submitSurvey=function(){var e=t.surveyInformation();(new Analytics).track("users","intention_survey",e)},t.surveyInformation=function(){var e={};return e.intention_response=jQuery("#intention_response").val(),e.contest_email=jQuery("#intention_email").val(),e.page=window.location.href,e}}}function blacklistClsIDComponents(e){for(var t=e,n=0;n<blacklistFixStrArr.length;n++)t=t.replace(blacklistFixStrArr[n],"");for(n=0;n<blacklistRegexArr.length;n++)t=t.replace(blacklistRegexArr[n],"");for(n=0;n<blacklistSearchWordsArrRegex.length;n++)t=t.replace(blacklistSearchWordsArrRegex[n],"");return t}function OntologyOwnsClass(e,t){return-1<(e=blacklistClsIDComponents(e)).toUpperCase().lastIndexOf(t)}function findOntologyOwnerOfClass(e,t){for(var n="",o=0,a={acronym:"",index:null,weight:0},r=0,i=t.length;r<i;r++)OntologyOwnsClass(e,n=t[r])&&(o=n.length*(e.toUpperCase().lastIndexOf(n)+1))>a.weight&&(a.acronym=n,a.index=r,a.weight=o);return a}function autoSearch(){var e=BP_queryString(),t=null,n=null,o=null;(e.hasOwnProperty("query")||e.hasOwnProperty("q"))&&(t=e.query||e.q,jQuery("#search_keywords").val(t),"true"===e.exactmatch||"true"===e.exact_match?jQuery("#search_exact_match").is(":checked")||jQuery("#search_exact_match").attr("checked",!0):jQuery("#search_exact_match").attr("checked",!1),"true"===e.searchproperties||"true"===e.include_properties?jQuery("#search_include_properties").is(":checked")||jQuery("#search_include_properties").attr("checked",!0):jQuery("#search_include_properties").attr("checked",!1),"true"===e.require_definition?jQuery("#search_require_definition").is(":checked")||jQuery("#search_require_definition").attr("checked",!0):jQuery("#search_require_definition").attr("checked",!1),"true"===e.include_views?jQuery("#search_include_views").is(":checked")||jQuery("#search_include_views").attr("checked",!0):jQuery("#search_include_views").attr("checked",!1),(e.hasOwnProperty("ontologyids")||e.hasOwnProperty("ontologies"))&&(n=(n=e.ontologies||e.ontologyids||"").split(","),jQuery("#ontology_ontologyId").val(n),jQuery("#ontology_ontologyId").trigger("chosen:updated")),e.hasOwnProperty("categories")&&(o=(o=e.categories||"").split(","),jQuery("#search_categories").val(o),jQuery("#search_categories").trigger("chosen:updated")),performSearch())}function currentSearchParams(){var e={},t=null;return e.q=jQuery("#search_keywords").val(),t=jQuery("#ontology_ontologyId").val(),e.ontologies=null===t?"":t.join(","),e.include_properties=jQuery("#search_include_properties").is(":checked"),e.include_views=jQuery("#search_include_views").is(":checked"),e.includeObsolete=jQuery("#search_include_obsolete").is(":checked"),e.require_definition=jQuery("#search_require_definition").is(":checked"),e.exact_match=jQuery("#search_exact_match").is(":checked"),e.categories=jQuery("#search_categories").val()||"",e}function objToQueryString(e){var t=[],n=null;for(n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}function performSearch(){jQuery("#search_spinner").show(),jQuery("#search_messages").html(""),jQuery("#search_results").html(""),jQuery("#result_stats").html("");var e=jQuery("#ontology_ontologyId").val()||null,t=null===e?"":e.join(","),n=jQuery("#search_keywords").val(),o=jQuery("#search_include_properties").is(":checked"),a=jQuery("#search_include_views").is(":checked"),r=jQuery("#search_include_obsolete").is(":checked"),i=jQuery("#search_include_non_production").is(":checked"),s=jQuery("#search_require_definition").is(":checked"),l=jQuery("#search_exact_match").is(":checked"),c=jQuery("#search_categories").val()||"";blacklistSearchWordsArr=n.split(/\s+/),jQuery.ajax({url:determineHTTPS(jQuery(document).data().bp.config.rest_url)+"/search",data:{q:n,include_properties:o,include_views:a,obsolete:r,include_non_production:i,require_definition:s,exact_match:l,categories:c,ontologies:t,pagesize:150,apikey:jQuery(document).data().bp.config.apikey,userapikey:jQuery(document).data().bp.config.userapikey,format:"jsonp",ncbo_slice:"ncbo_slice"in jQuery(document).data().bp.config?jQuery(document).data().bp.config.ncbo_slice:""},dataType:"jsonp",success:function(e){var t=[],n=null,o=jQuery("#result_stats"),a="",r="",i="";0<c.length&&(e.collection=filterCategories(e.collection,c)),jQuery.isEmptyObject(e)||(n=aggregateResults(e.collection),jQuery(n).each(function(){t.push(formatSearchResults(this))})),0===e.collection.length?(o.html(""),jQuery("#search_results").html("<h2 style='padding-top: 1em;'>No matches found</h2>")):(null===jQuery("#ontology_ontologyId").val()&&((r=jQuery("<span>")).attr("id","ontologies_count_total"),r.text(n.length),(a=jQuery("<a>")).attr({id:"ont_tooltip",href:"javascript:void(0)"}),a.append("Matches in "),a.append(r),a.append(" ontologies"),(i=jQuery("<div>")).attr("id","ontology_counts"),i.addClass("ontology_counts_tooltip"),a.append(i)),o.html(a),jQuery("#search_results").html(t.join(""))),jQuery("a[rel*=facebox]").facebox(),jQuery("#search_results").show(),jQuery("#search_spinner").hide()},error:function(){jQuery("#search_spinner").hide(),jQuery("#search_results").hide(),jQuery("#search_messages").html("<span style='color: red'>Problem searching, please try again")}})}function aggregateResults(e){return aggregateResultsWithSubordinateOntologies(aggregateResultsByOntology(e))}function aggregateResultsWithSubordinateOntologies(e){var t=[],n=null,o=null,a=null,r=null,i=[],s={};for(l=0,d=e.length;l<d;l++)r=ontologyIdToAcronym((n=e[l]).same_ont[0].links.ontology),i.push(r);blacklistSearchWordsArrRegex=[];for(var l=0;l<blacklistSearchWordsArr.length;l++){blacklistSearchWordsArrRegex.push(new RegExp(blacklistSearchWordsArr[l],blacklistRegexMod));for(var c=blacklistSearchWordsArr[l],u=!1,d=i.length-1;0<=d;d--)if(-1<i[d].indexOf(c)){u=!0;break}u?blacklistSearchWordsArr.splice(l,1):l++}for(l=0,d=e.length;l<d;l++)(n=e[l]).sub_ont=[],o=n.same_ont[0]["@id"],s.hasOwnProperty(o)||null!==(a=findOntologyOwnerOfClass(o,i)).index&&(s[o]=a);for(l=0,d=e.length;l<d;l++){if(o=(n=e[l]).same_ont[0]["@id"],s.hasOwnProperty(o))if((a=s[o]).index===l)t.push(n);else e[a.index].sub_ont.push(n);else t.push(n)}return t}function aggregateResultsByOntology(e){var t={list:[],hash:{}},n=null,o=null;for(var a in e)o=(n=e[a]).links.ontology,"undefined"==typeof t.hash[o]&&(t.hash[o]=initOntologyResults(),t.list.push(o)),t.hash[o].same_ont.push(n);return resultsByOntologyArray(t)}function initOntologyResults(){return{same_cls:[],same_ont:[],sub_ont:[]}}function resultsByOntologyArray(e){for(var t=[],n=null,o=0,a=e.list.length;o<a;o++)n=e.list[o],t.push(e.hash[n]);return t}function aggregateResultsByClassURI(e){var t={},n=null,o=null;for(var a in e)"undefined"==typeof t[o=(n=e[a])["@id"]]&&(t[o]={clsResults:[],clsOntOwner:null}),t[o].clsResults.push(n);return promoteClassesWithOntologyOwner(t),t}function promoteClassesWithOntologyOwner(e){var t=null,n=null,o=null;for(t in e)(n=e[t]).clsOntOwner=findClassWithOntologyOwner(t,n.clsResults),0<n.clsOntOwner.index&&(o=n.clsResults.splice(n.clsOntOwner.index,1)[0],n.clsResults.unshift(o),n.clsOntOwner.index=0)}function findClassWithOntologyOwner(e,t){for(var n="",o={index:null,acronym:""},a=0,r=t.length;a<r;a++)OntologyOwnsClass(n=ontologyIdToAcronym(t[a].links.ontology),clsID)&&n.length>o.acronym.length&&(o.acronym=n,o.index=a);return o}function sortResultsByOntology(e){return e.sort(function(e,t){var n=String(e.links.ontology).toLowerCase(),o=String(t.links.ontology).toLowerCase();return n<o?-1:o<n?1:0})}function formatSearchResults(e){var t=e.same_ont,n=e.same_cls,o=t.shift(),a=ontologyIdToAcronym(o.links.ontology),r=o["@id"],i=(encodeURIComponent(r),classLabelSpan(o)),s=null,l=null,c=null,u=null,d=null,p="",h=null,_="",y=null,g=null;(l=jQuery("<div>")).addClass("search_result"),l.attr("data-bp_ont_id",o.links.ontology),l.append(classDiv(o,i,!0)),l.append(definitionDiv(o)),(c=jQuery("<span>")).addClass("additional_results_link"),c.addClass("search_result_link"),(u=jQuery("<span>")).addClass("not_visible"),u.addClass("hide_link"),u.text("[hide]"),0<t.length&&(h={href:"#additional_ont_results","data-bp_ont":a,"data-bp_cls":r},(d=jQuery("<a>")).addClass("additional_ont_results_link"),d.addClass("search_result_link"),d.attr(h),d.append(t.length+" more from this ontology"),d.append(u.clone()),c.append(" - "),c.append(d),p=formatAdditionalOntResults(t,a)),0<n.length&&(y={href:"#additional_cls_results","data-bp_ont":a,"data-bp_cls":r},(g=jQuery("<a>")).addClass("additional_cls_results_link"),g.addClass("search_result_link"),g.attr(y),g.append(n.length+" more for this class"),g.append(u.clone()),c.append(" - "),c.append(g),_=formatAdditionalClsResults(n,a));var m="",f="";return 0<e.sub_ont.length&&((m=jQuery("<div>")).addClass("subordinate_ont_results"),(f=jQuery("<h3>")).addClass("subordinate_ont_results_title"),f.addClass("search_result_link"),f.attr("data-bp_ont",a),f.text("Reuses in other ontologies"),m.append(f),jQuery(e.sub_ont).each(function(){m.append(formatSearchResults(this))})),(s=jQuery("<div>")).addClass("search_result_links"),s.append(resultLinksSpan(o)),s.append(c),l.append(s),l.append(p),l.append(_),l.append(m),l.prop("outerHTML")}function formatAdditionalClsResults(e,t){var n=null,o=null,a=null,r=null,i=null;return(n=jQuery("<h3>")).addClass("additional_cls_results_title"),n.text("Same Class URI - Other Ontologies"),(o=jQuery("<div>")).attr("id","additional_cls_results_"+t),o.addClass("additional_cls_results"),o.addClass("not_visible"),o.append(n),jQuery(e).each(function(){(a=jQuery("<div>")).addClass("search_result_links"),a.append(resultLinksSpan(this)),r=classDiv(this,classLabelSpan(this),!0),(i=jQuery("<div>")).addClass("search_result_additional"),i.append(r),i.append(definitionDiv(this,"additional_def_container")),i.append(a),o.append(i)}),o}function formatAdditionalOntResults(e,t){var n=null,o=null,a=null,r=null,i=null;return(n=jQuery("<span>")).addClass("additional_ont_results_title"),n.addClass("search_result_link"),n.attr("data-bp_ont",t),n.text("Same Ontology - Other Classes"),(o=jQuery("<div>")).attr("id","additional_ont_results_"+t),o.addClass("not_visible"),jQuery(e).each(function(){(a=jQuery("<div>")).addClass("search_result_links"),a.append(resultLinksSpan(this)),r=classDiv(this,classLabelSpan(this),!1),(i=jQuery("<div>")).addClass("search_result_additional"),i.append(r),i.append(definitionDiv(this,"additional_def_container")),i.append(a),o.append(i)}),o}function updatePopupCounts(){var e=[],t=null,n=0;jQuery("#search_results div.search_result").each(function(){t=jQuery(this),n=t.children("div.additional_ont_results").find("div.search_result_additional").length+1,e.push(t.attr("data-bp_ont_name")+" <span class='popup_counts'>"+n+"</span><br/>")}),e.sort(sortStringFunction),jQuery("#ontology_counts").html(e.join(""))}function classLabelSpan(e){var t=60,n=e.prefLabel,o=null;return t<n&&(n=e.prefLabel.substring(0,t)+"..."),o=jQuery("<span>").text(n),!0===e.obsolete?(o.addClass("obsolete_class"),o.attr("title","obsolete class")):o.addClass("prefLabel"),o}function filterCategories(e,t){var n=[],o=null,a=null;return jQuery(e).each(function(){a=ontologyIdToAcronym((o=this).links.ontology),jQuery(t).each(function(){-1<categoriesMap[this].indexOf(a)&&n.push(o)})}),n}function shortenDefinition(e){var t=210,n=null;return null!=e&&0<e.length&&(e="string"==typeof e?e:e.join(". "),(e=jQuery("<div/>").html(e).text()).length>t&&((n=e.slice(0,t).split(" ")).pop(),e=n.join(" ")+" ...")),jQuery(document).trigger("search_results_updated"),e||""}function advancedOptionsSelected(){var e=null,t=null,n=null;if(0<=document.URL.indexOf("opt=advanced"))return!0;for(t=0,n=(e=[function(){return jQuery("#search_include_properties").is(":checked")},function(){return jQuery("#search_include_views").is(":checked")},function(){return jQuery("#search_include_non_production").is(":checked")},function(){return jQuery("#search_include_obsolete").is(":checked")},function(){return jQuery("#search_only_definitions").is(":checked")},function(){return jQuery("#search_exact_match").is(":checked")},function(){return null!==jQuery("#search_categories").val()&&0<(jQuery("#search_categories").val()||[]).length},function(){return null!==jQuery("#ontology_ontologyId").val()&&0<(jQuery("#ontology_ontologyId").val()||[]).length}]).length;t<n;t++)if(e[t]())return!0;return!1}function ontologyIdToAcronym(e){return e.split("/").slice(-1)[0]}function getOntologyName(e){var t=jQuery(document).data().bp.ontologies[e.links.ontology];return void 0===t?"":" - "+t.name+" ("+t.acronym+")"}function currentResultsCount(){return jQuery(".search_result").length+jQuery(".search_result_additional").length}function currentOntologiesCount(){return jQuery(".search_result").length}function classDiv(e,t,n){var o=null,a=null,r=null,i=null,s=null,l=null,c=null;return r=ontologyIdToAcronym(e.links.ontology),o=e["@id"],a="/ontologies/"+r+"?p=classes&conceptid="+encodeURIComponent(o),i=n?getOntologyName(e):"",s={title:e.prefLabel,"data-bp_conceptid":o,"data-exact_match":e.exactMatch,href:a},(l=jQuery("<a>")).attr(s),l.append(t),l.append(i),(c=jQuery("<div>")).addClass("concept_uri"),c.text(e["@id"]),jQuery("<div>").addClass("class_link").append(l).append(c)}function resultLinksSpan(e){var t=null,n=null,o=null,a=null,r=null,i=null,s=null;return t=ontologyIdToAcronym(e.links.ontology),n=e["@id"],o={href:"/ajax/class_details?ontology="+t+"&conceptid="+encodeURIComponent(n)+"&styled=false",rel:"facebox[.class_details_pop]"},(a=jQuery("<a>")).attr(o),a.addClass("class_details"),a.addClass("search_result_link"),a.text("details"),r={href:"javascript:void(0);","data-bp_conceptid":n,"data-bp_ontologyid":t},(i=jQuery("<a>")).attr(r),i.addClass("class_visualize"),i.addClass("search_result_link"),i.text("visualize"),(s=jQuery("<span>")).addClass("additional"),s.append(a),s.append(" - "),s.append(i),s}function definitionDiv(e,t){return t=void 0===t?"def_container":t,jQuery("<div>").addClass(t).text(shortenDefinition(e.definition))}function determineHTTPS(e){return e.replace("http:","https:"==document.location.protocol?"https:":"http:")}function toggleAdvancedSearchOptions(){var e=jQuery("#advanced_options"),t=jQuery("#search_options");e.text()==e.data("text-swap")?(e.text(e.data("text-original")),t.hide()):(e.data("text-original",e.text()),e.text(e.data("text-swap")),t.show())}function set_last_params(e){(bp_last_params=e).apikey=BP_CONFIG.apikey}function insertSampleText(e){"use strict";e.preventDefault();var t="Melanoma is a malignant tumor of melanocytes which are found predominantly in skin but also in the bowel and the eye.";jQuery("#annotation_text").focus(),jQuery("#annotation_text").val(t)}function get_annotations(){if(jQuery("#results_error").html(""),jQuery("#annotator_error").html(""),jQuery("#annotation_text").val())if(500<jQuery("#annotation_text").val().split(" ").length)jQuery("#annotator_error").html("Please use less than 500 words. If you need to annotate larger pieces of text you can use the <a href='http://www.bioontology.org/wiki/index.php/Annotator_User_Guide' target='_blank'>Annotator Web Service</a>");else{jQuery("#annotations_container").hide(),jQuery(".annotator_spinner").show(),ajax_process_halt();var t={},e=jQuery("#ontology_ontologyId"),n=[];t.text=jQuery("#annotation_text").val(),t.ontologies=null===e.val()?[]:e.val(),t.longest_only=jQuery("#longest_only").is(":checked"),t.exclude_numbers=jQuery("#exclude_numbers").is(":checked"),t.whole_word_only=!jQuery("#match_partial_words").is(":checked"),t.exclude_synonyms=jQuery("#exclude_synonyms").is(":checked"),t.ncbo_slice="ncbo_slice"in BP_CONFIG?BP_CONFIG.ncbo_slice:"";var o=parseInt(jQuery("#class_hierarchy_max_level").val());0<o&&(t.expand_class_hierarchy="true",t.class_hierarchy_max_level=o.toString()),t.raw=!0,jQuery("[name='mappings']:checked").each(function(){n.push(jQuery(this).val())}),t.mappings=n,null!==jQuery("#semantic_types").val()?(t.semantic_types=jQuery("#semantic_types").val(),annotationsTable.fnSetColumnVis(BP_COLUMNS.sem_types,!0),jQuery("#results_error").html("Only results from ontologies with semantic types available are displayed.")):annotationsTable.fnSetColumnVis(BP_COLUMNS.sem_types,!1),t.recognizer=jQuery("#recognizer").val(),jQuery.ajax({type:"POST",url:"/annotator",data:t,dataType:"json",success:function(e){set_last_params(t),display_annotations(e,bp_last_params),jQuery(".annotator_spinner").hide(200),jQuery("#annotations_container").show(300)},error:function(){set_last_params(t),jQuery(".annotator_spinner").hide(200),jQuery("#annotations_container").hide(),jQuery("#annotator_error").html(" Problem getting annotations, please try again")}})}else jQuery("#annotator_error").html("Please enter text to annotate")}function createFilterCheckboxes(e,n,t){"use strict";var o=[],a=[];jQuery.each(e,function(e,t){o.push({label:e+" ("+t+")",count:t,value:e,value_encoded:encodeURIComponent(e)})}),o.sort(function(e,t){return jQuery.trim(e.label)>jQuery.trim(t.label)}),jQuery.each(o,function(){var e=jQuery("<input/>").attr("class",n).attr("type","checkbox").attr("value",this.value).attr("id",n+this.value_encoded),t=jQuery("<label/>").attr("for",n+this.value_encoded).html(" "+this.label);a.push(jQuery("<span/>").append(e).append(t).html())}),jQuery("#"+t).html(a.join("<br/>"))}function annotatorFormatLink(e,t){"use strict";var n={json:"JSON",xml:"XML",text:"Text",tabDelimited:"CSV"},o=BP_CONFIG.rest_url+"/annotator?apikey="+BP_CONFIG.apikey+"&"+e;"json"!==t&&(o+="&format="+t);var a='<a href="'+encodeURI(o)+'" target="_blank">'+n[t]+"</a>";jQuery("#download_links_"+t.toLowerCase()).html(a)}function generateParameters(){"use strict";var n=[],e=jQuery.extend(!0,{},bp_last_params);return delete e.apikey,delete e.format,delete e.raw,jQuery.each(e,function(e,t){null!==t&&t!==undefined&&("boolean"==typeof t?n.push(e+"="+t):"string"==typeof t&&0<t.length?n.push(e+"="+t):"array"==typeof t&&0<t.length?n.push(e+"="+t.join(",")):"object"==typeof t&&0<t.length&&n.push(e+"="+t.join(",")))}),n.join("&")}function get_link(e,t){"use strict";return'<a href="'+e+'">'+t+"</a>"}function get_class_details(e){var t=e.ui.replace(/^.*\/\/[^\/]+/,""),n=t.replace(/\?p=classes.*$/,"?p=summary");return class_details={cls_rel_ui:t,ont_rel_ui:n,cls_link:get_link(t,e.prefLabel),ont_link:get_link(n,e.ontology.name),semantic_types:e.semantic_types.join("; ")}}function get_class_details_from_raw(e){var t=e.links.ontology.replace(/.*\//,""),n=annotator_ontologies[e.links.ontology].name,o="/ontologies/"+t,a=null;a=n===undefined?get_link_for_ont_ajax(t):get_link(o,n);var r=e.links.ui.replace(/^.*\/\/[^\/]+/,""),i=e.prefLabel,s=null;return s=i===undefined?get_link_for_cls_ajax(e["@id"],t):get_link(r,i),class_details={cls_rel_ui:r,ont_rel_ui:o,cls_link:s,ont_link:a,semantic_types:""}}function get_text_markup(e,t,n){var o=e.substring(t-1,n);return'<span style="color: rgb(153,153,153);">'+e.substring(0,t-1).replace(/.* ((?:[^ ]* ){2}[^ ]*$)/,"... $1")+('<span style="color: rgb(35, 73, 121); font-weight: bold; padding: 2px 0px;">'+o+"</span>")+e.substring(n).replace(/^((?:[^ ]* ){3}[^ ]*) [\S\s]*/,"$1 ...")+"</span>"}function get_annotation_rows(a,r){"use strict";var i=[],s=[],l="",c="",u={mgrep:"direct",mapping:"mapping",closure:"ancestor"},d=get_class_details(a.annotatedClass);return jQuery.each(a.annotations,function(e,t){l=get_text_markup(r.text,t.from,t.to),c=u[t.matchType.toLowerCase()]||"direct",s=[d.cls_link,d.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s),c="ancestor";var n=null;jQuery.each(a.hierarchy,function(e,t){n=get_class_details(t.annotatedClass),s=[n.cls_link,n.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s)}),c="mapping";var o=null;jQuery.each(a.mappings,function(e,t){o=get_class_details(t.annotatedClass),s=[o.cls_link,o.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s)})}),i}function get_annotation_rows_from_raw(a,r){"use strict";var i=[],s=[],l="",c="",u={mgrep:"direct",mapping:"mapping",closure:"ancestor"},d=get_class_details_from_raw(a.annotatedClass);return 0==a.annotations.length?(s=[d.cls_link,d.ont_link,"",d.semantic_types,"",d.cls_link,d.ont_link],i.push(s)):jQuery.each(a.annotations,function(e,t){l=get_text_markup(r.text,t.from,t.to),c=u[t.matchType.toLowerCase()]||"direct",s=[d.cls_link,d.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s),c="ancestor";var n=null;jQuery.each(a.hierarchy,function(e,t){n=get_class_details_from_raw(t.annotatedClass),s=[n.cls_link,n.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s)}),c="mapping";var o=null;jQuery.each(a.mappings,function(e,t){o=get_class_details_from_raw(t.annotatedClass),s=[o.cls_link,o.ont_link,c,d.semantic_types,l,d.cls_link,d.ont_link],i.push(s)})}),i}function update_annotations_table(e){"use strict";var u={},d={},p={},h={},_={},y=0;jQuery(e).each(function(){var e=this,t=e[0],n=e[1],o=e[2],a=e[5],r=e[6],i=t.replace(/^<a.*?>/,"").replace("</a>","").toLowerCase(),s=n.replace(/^<a.*?>/,"").replace("</a>",""),l=a.replace(/^<a.*?>/,"").replace("</a>","").toLowerCase(),c=r.replace(/^<a.*?>/,"").replace("</a>","");""!==e[4]&&y++,u[s]=s in u?u[s]+1:1,d[i]=i in d?d[i]+1:1,p[o]=o in p?p[o]+1:1,_[l]=l in _?_[l]+1:1,h[c]=c in h?h[c]+1:1});var t='<span class="result_count">';jQuery("#result_counts").html("total results "+t+e.length+"</span>&nbsp;");var n="direct"in p?p.direct:0,o="ancestor"in p?p.ancestor:0,a="mapping"in p?p.mapping:0;jQuery("#result_counts").append("("),jQuery("#result_counts").append("direct "+t+n+"</span>"),jQuery("#result_counts").append("&nbsp;/&nbsp;ancestor "+t+o+"</span>"),jQuery("#result_counts").append("&nbsp;/&nbsp;mapping "+t+a+"</span>"),jQuery("#result_counts").append(")"),createFilterCheckboxes(u,"filter_ontology_checkboxes","ontology_filter_list"),createFilterCheckboxes(d,"filter_classes_checkboxes","classes_filter_list"),createFilterCheckboxes(p,"filter_match_type_checkboxes","match_type_filter_list"),createFilterCheckboxes(h,"filter_matched_ontology_checkboxes","matched_ontology_filter_list"),createFilterCheckboxes(_,"filter_matched_classes_checkboxes","matched_classes_filter_list"),annotationsTable.fnClearTable(),annotationsTable.fnSortNeutral(),removeFilters(),filter_ontologies.init(),filter_classes.init(),filter_match_type.init(),filter_matched_ontologies.init(),filter_matched_classes.init(),0<e.length&&annotationsTable.fnAddData(e),0==y?annotationsTable.fnSetColumnVis(4,!1):annotationsTable.fnSetColumnVis(4,!0);var r=Object.keys(p);1==r.length&&""===r[0]&&annotationsTable.fnSetColumnVis(2,!1)}function display_annotations(e,t){"use strict";var n=e.annotations,o=[];if(t.raw!==undefined&&!0===t.raw){annotator_ontologies=e.ontologies;for(var a=0;a<n.length;a++)o=o.concat(get_annotation_rows_from_raw(n[a],t))}else for(a=0;a<n.length;a++)o=o.concat(get_annotation_rows(n[a],t));update_annotations_table(o);var r=generateParameters(),i=BP_CONFIG.rest_url+"/annotator?"+r,s=BP_CONFIG.rest_url+"/annotator?"+encodeURIComponent(r);jQuery("#annotator_parameters").html(i),jQuery("#annotator_parameters_encoded").html(s),annotatorFormatLink(r,"json"),annotatorFormatLink(r,"xml"),t.raw!==undefined&&!0===t.raw&&ajax_process_init()}function pageInit(){var e,t={},n=["root","resources","acronym"];"undefined"!=typeof(e=History.getState().hash.split("?"))[1]||e[1],e=e[0].split("/").slice(1);for(var o=0;o<e.length;o++)t[n[o]]=e[o];jQuery.extend(t,BP_urlParams),"undefined"!=typeof(BP_urlParams=t).acronym?router.route("resource",t):"undefined"!=typeof t.resources&&router.route("resources",t)}function pushDisplayResource(e,t){var n="resource";bpResourceIndexEmbedded?router.route(n,t):(t.route=n,History.pushState(t,document.title,e))}function pushDisplayResources(e,t){var n="resources";bpResourceIndexEmbedded?router.route(n,t):(t.route=n,History.pushState(t,document.title,e))}function pushIndex(){var e="index";bpResourceIndexEmbedded?router.route(e):History.pushState(null,document.title,"/resource_index")}function replaceIndex(){var e="index";bpResourceIndexEmbedded?router.route(e):History.replaceState(null,document.title,"/resource_index")}function lookupClassLabels(){jQuery("#resource_results a.ri_concept[data-applied_label='false']").each(function(){var t,e=jQuery(this),n={conceptid:decodeURIComponent(e.data("concept_id")),ontologyid:e.data("ontology_id")};if(e.attr("data-applied_label","true"),"getting"===bp_classes_cache[n.ontologyid+"/"+n.conceptid])return setTimeout(function(){return applyClassLabel(e,n)},100);"undefined"==typeof bp_classes_cache[n.ontologyid+"/"+n.conceptid]&&(bp_classes_cache[n.ontologyid+"/"+n.conceptid]="getting",jQuery.ajax({url:"/ajax/json_class",data:n,dataType:"json",success:(t=this,function(e){null!==(bp_classes_cache[n.ontologyid+"/"+n.conceptid]=e)&&jQuery(t).html(e.prefLabel)})}))})}function applyClassLabel(e,t,n){var o=bp_classes_cache[t.ontologyid+"/"+t.conceptid];if("getting"===o)return void 0!==n&&(n=0),setTimeout(function(){return applyClassLabel(e,t,n+=1)},100);null!==o&&jQuery(e).html(o.prefLabel)}function Router(){this.route=function(e,t){switch(e){case"index":this.index();break;case"resource":this.resource(t);break;case"resources":this.resources(t)}},this.index=function(){jQuery("#results").html(""),jQuery("#results_error").html(""),jQuery("#initial_resources").show()},this.resource=function(e){"undefined"!=typeof e.classes&&"undefined"!=typeof e.acronym||replaceIndex(),displayResource(e)},this.resources=function(e){"undefined"==typeof e.classes&&replaceIndex(),displayResources(e.classes)}}function displayResource(e){var t=e.acronym;if(t!==undefined&&resources[t]!==undefined){var n=resources[t].name;null===jQuery("#resource_index_classes").val()?displayClasses(e.classes,function(){showResourceResults(t,n)}):showResourceResults(t,n)}}function displayResources(e){null===jQuery("#resource_index_classes").val()?displayClasses(e):showAllResources()}function displayClasses(e,o){var t,n,a,r,i,s,l=0,c=[];for(ontology in e){i=e[ontology];for(var u=0;u<i.length;u++)c.push([ontology,i[u]])}a=c.length,jQuery("#resource_index_classes").html("");for(u=0;u<c.length;u++)ontClassPair=c[u],t=ontClassPair[0],ontologyAcronym=ontClassPair[0].split("/").slice(-1)[0],n=ontClassPair[1],ont_names[t],r={ontologyid:ontologyAcronym,conceptid:n},s=t+uri_split_chars+n,jQuery.getJSON("/ajax/json_class",r,function(t,n){return function(e){jQuery("#resource_index_classes").append(jQuery("<option/>").attr("selected",!0).val(n).html(" "+e.prefLabel+" <span class='search_ontology_acronym'>("+t+")</span>")),(l+=1)==a&&getSearchResults(o)}}(ontologyAcronym,s))}function getSearchResults(t){jQuery("#results_error").html(""),jQuery("#resource_index_spinner").show(),jQuery("#results.contains_search_results").hide();var e={classes:chosenSearchClasses(),boolean_operator:jQuery("input:radio[name=boolean_operator]:checked").val(),expand_hierarchy:jQuery("input:radio[name=expand_hierarchy]:checked").val()};jQuery.ajax({type:"POST",url:"/resource_index",data:e,dataType:"html",success:function(e){jQuery("#results").html(e),jQuery("#results").addClass("contains_search_results"),jQuery("#results.contains_search_results").show(),jQuery("#results_container").show(),jQuery("#resource_index_spinner").hide(),t&&"function"==typeof t&&t(),jQuery("#initial_resources").hide(),jQuery("#resource_table table").dataTable({paging:!1,searching:!1,columns:[{type:"html"},{type:"html-num-fmt",orderSequence:["desc","asc"]},{type:"num-fmt",orderSequence:["desc","asc"]},{type:"num-fmt",orderSequence:["desc","asc"]}]}),updateCounts()},error:function(){jQuery("#resource_index_spinner").hide(),jQuery("#results_error").html("Problem retrieving search results, please try again")}})}function updateCounts(){var e,t,n;e=jQuery("#resource_table table tbody tr.not_visible").length,n=(t=jQuery("#resource_table table tbody tr").length)-e,jQuery("#result_counts").html("matches in "+n+" of "+t+" resources")}function showResourceResults(e,t){jQuery("#resource_info_"+e).find("a.resource_results_ajax").addClass("get_via_ajax"),jQuery(".resource_info").addClass("not_visible"),jQuery("#resource_table").addClass("not_visible"),jQuery("#resource_info_"+e).removeClass("not_visible"),jQuery("#resource_title").html(t),jQuery(".resource_title").removeClass("not_visible"),jQuery("#resource_title").removeClass("not_visible"),updateCounts()}function showAllResources(){jQuery(".resource_info").addClass("not_visible"),jQuery(".resource_title").addClass("not_visible"),jQuery("#resource_title").addClass("not_visible"),jQuery("#resource_table").removeClass("not_visible"),updateCounts()}function Element(e,t,n,o){this.positions,this.id=e,this.cleanId=t,this.jdomId="#"+t+"_text",this.classes=n,this.resource=o,this.loadAni=null,this.highlightAnnotationPositions=function(){var t=this,n={};jQuery(this.jdomId).find(".element_text p").each(function(){var e=jQuery(this);n[e.data().contextName]=e.html()}),jQuery.ajax({url:"/resource_index/element_annotations?"+chosenSearchClassesArgs(this.classes),data:{elementid:this.id,element_text:n,acronym:this.resource},dataType:"json",type:"POST",success:function(e){t.positions=e,t.highlight()}})},this.highlight=function(){var o=this;jQuery.each(this.positions,function(e,t){var n=jQuery(o.jdomId+" p[data-context-name="+e+"]");0<t.length&&(highlighter=new PositionHighlighter,n.html(highlighter.highlightUsingPosition(n.html(),t)))}),jQuery("#"+this.cleanId+"_link").find(".highlighting").remove(),null!==this.loadAni&&clearInterval(this.loadAni)}}function PositionHighlighter(){this.offsetPositions=[],this.textToHighlight="",this.highlightUsingPosition=function(e,t){var n,o,a,r=1,i=e.length,s=t.length;this.textToHighlight=jQuery("<div/>").html(e).text();for(var l=r;l<=i;l++)this.offsetPositions[l]=0;for(var c=0;c<s;c++)n=t[c].type||"direct",o=t[c].from,a=t[c].to,this.addText("<span class='"+n+"'>",o,-1),this.addText("</span>",a,0);return this.textToHighlight},this.updatePositions=function(e,t){for(var n=this.offsetPositions.length,o=e;o<=n;o++)this.offsetPositions[o]+=t},this.addText=function(e,t,n){this.textToHighlight=[this.textToHighlight.slice(0,this.getActualPosition(t)+n),e,this.textToHighlight.slice(this.getActualPosition(t)+n)].join(""),this.updatePositions(t,e.length)},this.getActualPosition=function(e){return e+this.offsetPositions[e]}}function currentOntologyIds(){var e=jQuery("#ontology_ontologyId").val();return null===e||""===e?ont_ids:e}function currentOntologyAcronyms(){for(var e=new Array,t=currentOntologyIds(),n=0;n<t.length;n++)e.push(t[n].split("/").slice(-1)[0]);return e}function chosenSearchClasses(){var e={},t=jQuery("#resource_index_classes").val();if(null===t)return e;"string"==typeof t&&(t=t.split());for(var n=0;n<t.length;n++){var o=t[n],a=uri_split(o),r=a[0],i=a[1];e.hasOwnProperty(r)||(e[r]=new Array),e[r].push(i)}return e}function chosenSearchClassesArgs(e){e===undefined&&(e=chosenSearchClasses());var t="";for(var n in e){var o=e[n];t+="classes["+encodeURIComponent(n)+"]=",t+=encodeURIComponent(o.join(",")),t+="&"}return t.slice(0,-1)}function updateMappingCount(){var e=jQuery("#concept_mappings_table tbody tr"),t=null;e.first().children("td").each(function(){-1<this.innerHTML.indexOf("no mappings")&&(t=0)}),null===t&&(t=e.length),jQuery("#mapping_count").html(t)}function updateMappingDeletePermissions(){var e=jQuery("#delete_mappings_permission");0===e.length?(jQuery("#delete_mappings_button").hide(),jQuery(".delete_mappings_column").hide(),jQuery(
"input[name='delete_mapping_checkbox']").prop("disabled",!0)):(e.hide(),e.is(":checked")?(jQuery("#delete_mappings_button").show(),jQuery(".delete_mappings_column").show(),jQuery("input[name='delete_mapping_checkbox']").prop("disabled",!1)):(jQuery("#delete_mappings_button").hide(),jQuery(".delete_mappings_column").hide(),jQuery("input[name='delete_mapping_checkbox']").prop("disabled",!0))),jQuery("input[name='delete_mapping_checkbox']").prop("checked",!1)}function loadMappings(e){if(jQuery("#mappingCount").html(""),jQuery("#mapping_load").show(),jQuery("#display_table").is(":checked"))jQuery("#mappingCount").load("/mappings/count/"+e,function(){jQuery("#mapping_load").hide(),jQuery("#mapping_count_table").effect("highlight",{color:"#F5F5F5"},500),jQuery("#mapping_count_table").dataTable({paging:!1,info:!1,searching:!1,columns:[null,{type:"num-fmt",orderSequence:["desc","asc"]}]})});else{jQuery("#mapping_load").hide();var t=jQuery("<iframe>",{src:"//biomixer.bioontology.org/ontologyMappingOverview.html?ontology_acronym="+e,frameborder:"0",width:"100%",height:"800"});jQuery("#mappingCount").html(t)}}function deleteMappings(){var e,t=[],n=jQuery(document).data().bp.ont_viewer.ontology_id,o=jQuery(document).data().bp.ont_viewer.concept_id;jQuery("#delete_mappings_error").html(""),jQuery("#delete_mappings_spinner").show(),jQuery("input[name='delete_mapping_checkbox']:checked").each(function(){t.push(jQuery(this).val())}),e={mappingids:t.join(","),_method:"delete",ontologyid:n,conceptid:o},jQuery("#delete_mappings_error").html(""),jQuery.ajax({url:"/mappings/mappingids",type:"POST",data:e,success:function(e){jQuery("#delete_mappings_spinner").hide();var t,n,o=e.success.length;for(t=0;t<o;++t)n=e.success[t].replace(/.*\//,""),jQuery("#"+n).hide();for(o=e.error.length,t=0;t<o;++t)jQuery("#delete_mappings_error").html("There was a problem deleting, please try again"),n=e.error[t].replace(/.*\//,""),jQuery("#"+n).css("border","red solid");jQuery("#mapping_count").html(jQuery("#mapping_details tbody tr:visible").size()),jQuery.bioportal.ont_pages.mappings.retrieve_and_publish(),updateMappingDeletePermissions()},error:function(){jQuery("#delete_mappings_spinner").hide(),jQuery("#delete_mappings_error").html("There was a problem deleting, please try again")}})}function toggleShow(e){problemOnly=e}function millisToMinutesAndSeconds(e){return Math.floor(e/6e4)+" minutes "+(e%6e4/1e3).toFixed(0)+" seconds"}function parseReportDate(e){if(""===e.trim())return"";var t=/^(((0[13578]|1[02])[\/\.-](0[1-9]|[12]\d|3[01])[\/\.-]((19|[2-9]\d)\d{2}),\s(0[0-9]|1[0-2]):(0[0-9]|[1-59]\d)\s(AM|am|PM|pm))|((0[13456789]|1[012])[\/\.-](0[1-9]|[12]\d|30)[\/\.-]((19|[2-9]\d)\d{2}),\s(0[0-9]|1[0-2]):(0[0-9]|[1-59]\d)\s(AM|am|PM|pm))|((02)[\/\.-](0[1-9]|1\d|2[0-8])[\/\.-]((19|[2-9]\d)\d{2}),\s(0[0-9]|1[0-2]):(0[0-9]|[1-59]\d)\s(AM|am|PM|pm))|((02)[\/\.-](29)[\/\.-]((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00)),\s(0[0-9]|1[0-2]):(0[0-9]|[1-59]\d)\s(AM|am|PM|pm)))$/g.exec(e);t=t.filter(function(e){return e});var n=Number(t[7]),o=t[9].toUpperCase();"PM"==o&&n<12&&(n+=12),"AM"==o&&12==n&&(n-=12);var a=n.toString(),r=(Number(t[3])-1).toString();return new Date(t[5],r,t[4],a,t[8],"00","00").toLocaleString([],{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function ResetMemcacheConnection(){AjaxAction.call(this,"POST","UI CACHE CONNECTION RESET","resetcache",!1),this.setConfirmMsg("")}function FlushMemcache(){AjaxAction.call(this,"POST","FLUSHING OF UI CACHE","clearcache",!1),this.setConfirmMsg("")}function ClearGooCache(){AjaxAction.call(this,"POST","FLUSHING OF GOO CACHE","clear_goo_cache",!1),this.setConfirmMsg("")}function ClearHttpCache(){AjaxAction.call(this,"POST","FLUSHING OF HTTP CACHE","clear_http_cache",!1),this.setConfirmMsg("")}function DeleteSubmission(e,t){AjaxAction.call(this,"DELETE","SUBMISSION DELETION","ontologies/"+e+"/submissions/"+t,!1,{ontologies:e}),this.submissionId=t,this.setConfirmMsg("Are you sure you want to delete submission <span style='color:red;font-weight:bold;'>"+t+"</span> for ontology <span style='color:red;font-weight:bold;'>"+e+"</span>?<br/><b>This action CAN NOT be undone!!!</b>")}function RefreshReport(){AjaxAction.call(this,"POST","REFRESH OF ONTOLOGIES REPORT","refresh_ontologies_report",!0);var e="Refreshing this report takes a while...<br/>Are you sure you're ready for some coffee time?";this.setSelectedOntologies(),0<this.ontologies.length?e="Ready to refresh report for ontologies:"+this.getSelectedOntologiesForDisplay()+"Proceed?":this.ontologies=[DUMMY_ONTOLOGY],this.setConfirmMsg(e)}function DeleteOntologies(){AjaxAction.call(this,"DELETE","ONTOLOGY DELETION","ontologies",!1),this.setSelectedOntologies(),this.setConfirmMsg("You are about to delete the following ontologies:"+this.getSelectedOntologiesForDisplay()+"<b>This action CAN NOT be undone!!! Are you sure?</b>")}function ProcessOntologies(e){var t={all:"FULL ONTOLOGY RE-PROCESSING",process_annotator:"PROCESSING OF ONTOLOGY FOR ANNOTATOR",diff:"CALCULATION OF ONTOLOGY DIFFS",index_search:"PROCESSING OF ONTOLOGY FOR SEARCH",run_metrics:"CALCULATION OF ONTOLOGY METRICS"};AjaxAction.call(this,"PUT",t[e],"ontologies",!1,{actions:e}),this.setSelectedOntologies(),this.setConfirmMsg("You are about to perform "+t[e]+" on the following ontologies:"+this.getSelectedOntologiesForDisplay()+"The ontologies will be added to the queue and processed on the next cron job execution.<br style='margin:10px 0;'/><b>Should I proceed?</b>")}function UpdateCheck(e){var t={};e&&(t.force_check=e),AjaxAction.call(this,"GET","CHECK FOR UPDATE","update_info",!1,t),this.setProgressMessageEnabled(e),this.setConfirmMsg("")}function performActionOnOntologies(){var e=jQuery("#admin_action").val();if(e)switch(e){case"delete":DeleteOntologies.act();break;default:ProcessOntologies.act(e)}else alertify.alert("Please choose an action to perform on the selected ontologies.")}function populateOntologyRows(e){var t=e.ontologies,n=[],o=["format","administeredBy","date_created","report_date_updated","errErrorStatus","errMissingStatus","problem","logFilePath"];for(var a in t){var r=[],i=t[a],s="<a href='/ontologies/"+a+"' target='_blank' style='"+(!0===i.problem?"color:red;":"")+"'>"+a+"</a>",l="",c=i.format,u=i.administeredBy,d=parseReportDate(i.report_date_updated),p=parseReportDate(i.date_created);""!=i.logFilePath&&(l+="<a href='/admin/ontologies/"+a+"/log' target='_blank'>Log</a>&nbsp;&nbsp;|&nbsp;&nbsp;"),l+="<a href='"+BP_CONFIG.rest_url+"/ontologies/"+a+"?apikey="+BP_CONFIG.apikey+"&userapikey: "+BP_CONFIG.userapikey+"' target='_blank'>REST</a>&nbsp;&nbsp;|&nbsp;&nbsp;",l+="<a id='link_submissions_"+a+"' href='javascript:;' onclick='showSubmissions(event, \""+a+"\")'>Submissions</a>";var h=i.errErrorStatus?i.errErrorStatus.join(", "):"",_=i.errMissingStatus?i.errMissingStatus.join(", "):"";for(var y in i)-1===jQuery.inArray(y,o)&&r.push(i[y]);var g=[s,u.join("<br/>"),c,p,d,l,h,_,r.join("<br/>"),i.problem];n.push(g)}return n}function isDateGeneratedSet(e){return/^\d{2}\/\d{2}\/\d{4}\,\s\d{2}:\d{2}\s\w{2}$/i.test(e.report_date_generated)}function setDateGenerated(e){var t="Generate";isDateGeneratedSet(e)&&(t="Refresh"),jQuery(".report_date_generated").text(e.report_date_generated).html(),jQuery(".report_date_generated_button").text(t).html()}function _showStatusMessages(e,t,n,o){if(0<e.length){if(o){var a=jQuery.trim(jQuery("#success_message").html()).length?", ":"";jQuery("#success_message").append(a+e.join(", ")).html()}else jQuery("#success_message").text(e.join(", ")).html();jQuery("#success_message").show()}if(0<t.length){if(o){a=jQuery.trim(jQuery("#error_message").html()).length?", ":"";jQuery("#error_message").append(a+t.join(", ")).html()}else jQuery("#error_message").text(t.join(", ")).html();jQuery("#error_message").show()}if(0<n.length){if(o){a=jQuery.trim(jQuery("#info_message").html()).length?", ":"";jQuery("#info_message").append(a+n.join(", ")).html()}else jQuery("#info_message").text(n.join(", ")).html();jQuery("#info_message").show()}}function displayOntologies(n,e){var t=null;if(jQuery.fn.dataTable.isDataTable("#adminOntologies"))if(t=jQuery("#adminOntologies").DataTable(),e===DUMMY_ONTOLOGY)allRows=populateOntologyRows(n),t.clear(),t.rows.add(allRows),t.draw(),setDateGenerated(n);else{var o=jQuery("#tr_"+e),a=t.row(o),r={ontologies:{}};r.ontologies[e]=n.ontologies[e],allRows=populateOntologyRows(r),a.data(allRows[0]),a.invalidate().draw(),o.removeClass("selected")}else t=jQuery("#adminOntologies").DataTable({ajax:{url:"/admin/ontologies_report",contentType:"application/json",dataSrc:function(e){return populateOntologyRows(e)}},rowCallback:function(e,t){var n=jQuery("td:first",e).text();jQuery(e).attr("id","tr_"+n),!0===t[t.length-1]&&jQuery(e).addClass("problem")},initComplete:function(e,t){t.errors&&isDateGeneratedSet(n)&&_showStatusMessages([],[t.errors],[],!1),setDateGenerated(t)},columnDefs:[{targets:0,searchable:!0,title:"Ontology",width:"160px"},{targets:1,searchable:!0,title:"Admin",width:"160px"},{targets:2,searchable:!0,title:"Format",width:"55px"},{targets:3,searchable:!0,title:"Date Created",type:"date",width:"170px"},{targets:4,searchable:!0,title:"Report Date",type:"date",width:"170px"},{targets:5,searchable:!1,orderable:!1,title:"URL",width:"140px"},{targets:6,searchable:!0,title:"Error Status",width:"130px"},{targets:7,searchable:!0,title:"Missing Status",width:"130px"},{targets:8,searchable:!0,title:"Issues"},{targets:9,searchable:!0,visible:!1}],autoWidth:!1,lengthChange:!1,searching:!0,language:{search:"Filter: ",emptyTable:"No ontologies available"},info:!0,paging:!0,pageLength:100,ordering:!0,stripeClasses:["","alt"],dom:'<"ontology_nav"><"top"fi>rtip',customAllowOntologiesFilter:!0});return t}function showSubmissions(e,t){e.preventDefault(),jQuery.facebox({ajax:"/admin/ontologies/"+t+"/submissions"})}function showOntologiesToggleLinks(e){var t="View Ontologies:&nbsp;&nbsp;&nbsp;&nbsp;";return t+=e?'<a id="show_all_ontologies_action" href="javascript:;">All</a>&nbsp;&nbsp;|&nbsp;&nbsp;<strong>Problem Only</strong>':'<strong>All</strong>&nbsp;&nbsp;|&nbsp;&nbsp;<a id="show_problem_only_ontologies_action" href="javascript:;">Problem Only</a>'}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function jumpToValueOntology(){jQuery("#find_ontology")[0].value;var e=jQuery("#find_ontology_id").val();if(null==e||""==e)return alert("The ontology does not exist. You must pick an ontology from the list."),!1;if(e){var t=jQuery("#find_ontology_id").val();return null!=t&&""!=t||(t=data),document.location="/ontologies/"+t,void jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" /> Loading Ontology...</h1>'})}}function formatResultOntologySearch(e){jQuery("#find_ontology_id").val("");var t=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),n=jQuery("#find_ontology").val().replace(t,"\\$&").split(" ").join("|"),o=new RegExp("("+n+")","gi");return e.replace(o,"<b><span style='color:#006600;'>$1</span></b>")}function selectFindOntology(e){jQuery("#find_ontology_id").val(e.data[0]),jQuery("#find_ontology").focus(),jumpToValueOntology()}function descriptionDialog(e,t){jQuery("#DescriptionDialog").text(t),jQuery("#DescriptionDialog").css("display:block"),jQuery("#DescriptionDialog").dialog({dialogClass:"alert"})}function location_toggle(e){jQuery(".hidden_field").hide(),jQuery(".hidden_field input").attr("disabled",!0),jQuery("#"+e+" input").removeAttr("disabled"),jQuery("#"+e).show()}function addContact(e){e.preventDefault();var t=document.querySelectorAll("div.contact"),n=t[0].cloneNode(!0);n.classList.add("offset-sm-2");var o=n.querySelector("button").cloneNode(!0);o.classList.replace("btn-success","btn-danger"),o.classList.replace("add-contact","remove-contact"),o.classList.add("ml-1"),o.querySelector("i").classList.replace("fa-plus","fa-minus"),n.appendChild(o);for(var a=t.length,r=n.getElementsByTagName("input"),i=0;i<r.length;i++){var s=r[i],l=s.getAttribute("id").replace(/0/g,a);s.setAttribute("id",l);var c=s.getAttribute("name").replace(/0/g,a);s.setAttribute("name",c),s.setAttribute("value",""),s.removeAttribute("required")}t[a-1].insertAdjacentElement("afterend",n)}function removeContact(e){e.preventDefault();var t,n=e.target;n.matches("button.remove-contact")?t=n.parentNode:n.matches("i.fa-minus")&&(t=n.parentNode.parentNode),document.querySelector("#contacts").removeChild(t)}function toggleOntologyFormatOptions(e){var t=jQuery("#collapseOWLOptions"),n=jQuery("#helpSkosFormat");switch(e){case"OWL":t.show(),n.hide();break;case"SKOS":t.hide(),n.show();break;default:t.hide(),n.hide()}}jQuery.bioportal={},jQuery.curCSS=jQuery.css,$(document).ajaxSend(function(e,t){var n=$("meta[name='csrf-token']").attr("content");t.setRequestHeader("X-CSRF-Token",n)});var currentOntology,currentConcept,myEditor,dialog,cache=new Object,que=new Array,queIndex=0,thread=0,tabs=null;jQuery.QueryString=function(e){if(""==e)return{};for(var t={},n=0;n<e.length;++n){var o=e[n].split("=");2==o.length&&(t[o[0]]=decodeURIComponent(o[1].replace(/\+/g," ")))}return t}(window.location.search.substr(1).split("&")),jQuery("div.footer-support, div.dropdown-menu.dropdown-menu-right").on("click","a.pop_window",{w:"800",h:"600"},bpPopWindow);var bp_popup_init=function(e){bp_popup_cleanup(),e.preventDefault(),e.stopPropagation();var t=jQuery(e.currentTarget).parents(".popup_container"),n=t.children(".bp_popup_list");t.children(".bp_popup_link_container").addClass("bp_popup_shadow"),t.find("a.bp_popup_link").css("z-index","5000").addClass("bp_popup_link_active"),t.children(".bp_popup_list").show(),n.width()+n.offset().left>jQuery(window).width()&&n.css("left","-250px")},bp_popup_cleanup=function(){jQuery(".bp_popup_link_container").removeClass("bp_popup_shadow"),jQuery(".bp_popup_link").css("z-index","").removeClass("bp_popup_link_active"),jQuery(".bp_popup_list").hide()};jQuery(window).ready(function(){jQuery("input[type=text].help_text, textarea.help_text").each(function(){""==jQuery(this).val()?(jQuery(this).val(jQuery(this).attr("title")),jQuery(this).addClass("help_text_font")):jQuery(this).removeClass("help_text_font")}),jQuery("input[type=text].help_text, textarea.help_text").live("focus",function(){var e=jQuery(this);e.attr("title")==e.val()&&(e.val(""),e.removeClass("help_text_font"))}),jQuery("input[type=text].help_text, textarea.help_text").live("blur",function(){var e=jQuery(this);""==e.val()&&(e.val(e.attr("title")),e.addClass("help_text_font"))})}),jQuery(document).ready(function(){jQuery("a.link_button, input.link_button").button()}),jQuery(document).ready(function(){jQuery("a.truncated_more").live("click",function(){var e=jQuery(this);e.parents("span.more_less_container").find(".truncated_more").hide(),e.parents("span.more_less_container").find(".truncated_less").show()}),jQuery("a.truncated_less").live("click",function(){var e=jQuery(this);e.parents("span.more_less_container").find(".truncated_less").hide(),e.parents("span.more_less_container").find(".truncated_more").show()})}),jQuery(document).ready(function(){setTimeout(getAjaxContent,1e3)}),jQuery(".pagination a").live("click",function(e){var t=jQuery(this),n=t.closest(".paginate_ajax");e.preventDefault(),0<n.length?n.load(t.attr("href")):t.closest("div.pagination").parent().load(t.attr("href"))}),jQuery.facebox.settings.closeImage="/assets/facebox/closelabel-3792a485ee43385b7848dd725ae759c70fa7acd82328ffced4ab269ef3e5bb76.png",jQuery.facebox.settings.loadingImage="/assets/facebox/loading-81ea81be1d862d36c34b6dc4f12aefb87b656e319003263d8274974b48ccf869.gif";var simpleTreeCollection,classesPaneSplitter,BP_setCookie=function(e,t,n){void 0===n&&(n={});var o=n.days||null,a=n.seconds||null,r=new Date,i="";null!==a&&(r.setSeconds(r.getSeconds()+a),i=" expires="+r.toGMTString()),null!==o&&(r.setDate(r.getDate()+o),i=" expires="+r.toGMTString()),document.cookie=e+"="+t+";"+i},BP_getCookies=function(){for(var e=document.cookie.split(";"),t={},n=0;n<e.length;n++){var o=e[n].split("=");t[jQuery.trim(o[0])]=unescape(jQuery.trim(o[1]))}return t},BP_getCookie=function(e){return BP_getCookies()[e]},currentPathArray=function(){var e,t=[];e=window.location.pathname.split("/");for(var n=0;n<e.length;n++)0<e[n].length&&t.push(e[n]);return t};jQuery(document).ready(function(){pageUsesTreeView()&&getTreeView()});var ajax_process_cls_interval=null,ajax_process_ont_interval=null,ajax_process_timeout=20,ajax_process_timing=250,ajax_process_init=function(){ajax_process_cls_init(),ajax_process_ont_init()},ajax_process_halt=function(){ajax_process_cls_halt(),ajax_process_ont_halt()},ajax_ont_array=[],ajax_process_ont_init=function(){ajax_ont_array=jQuery("a.ont4ajax").toArray(),ajax_process_ont_interval=window.setInterval(ajax_process_ont,ajax_process_timing)},ajax_process_ont_halt=function(){ajax_ont_array=[],window.clearInterval(ajax_process_ont_interval)},ajax_process_ont=function(){if(0===ajax_ont_array.length)return ajax_process_ont_halt(),!0;var n=ajax_ont_array.shift();if(n===undefined)return!0;if((n=jQuery(n)).hasClass("ajax-modified-ont"))return n.removeClass("ont4ajax"),!0;n.removeClass("ont4ajax");var e=n.attr("data-ont"),t="/ajax/json_ontology/?ontology="+encodeURIComponent(e);jQuery.ajax({url:t,timeout:1e3*ajax_process_timeout,success:function(e){if(void 0!==e&&e.hasOwnProperty("name")){var t=e.name;n.text(t),n.addClass("ajax-modified-ont"),jQuery('a[href="/ontologies/'+ontAcronym+'"]').each(function(){var e=jQuery(this);e.hasClass("ajax-modified-ont")||(e.removeClass("ont4ajax"),e.text(t),e.addClass("ajax-modified-ont"))})}},error:function(){n.addClass("ajax-error")}})},ajax_cls_array=[],ajax_process_cls_init=function(){ajax_cls_array=jQuery("a.cls4ajax").toArray(),ajax_process_cls_interval=window.setInterval(ajax_process_cls,ajax_process_timing)},ajax_process_cls_halt=function(){ajax_cls_array=[],window.clearInterval(ajax_process_cls_interval)},ajax_process_cls=function(){if(0===ajax_cls_array.length)return ajax_process_cls_halt(),!0;var n=ajax_cls_array.shift();if(n===undefined)return!0;if((n=jQuery(n)).hasClass("ajax-modified-cls"))return n.removeClass("cls4ajax"),!0;n.removeClass("cls4ajax");var o=n.attr("href"),a=n.attr("data-cls"),e=n.attr("data-ont"),r="/ontologies/"+e+"?p=classes&conceptid="+encodeURIComponent(a),t="/ajax/classes/label?ontology="+e+"&concept="+encodeURIComponent(a);jQuery.ajax({url:t,timeout:1e3*ajax_process_timeout,success:function(e){if(void 0!==(e=e.trim())&&0<e.length&&0!==e.indexOf("http")){var t=e;n.html(t),n.attr("href",r),n.addClass("ajax-modified-cls"),jQuery('a[href="'+o+'"]').each(function(){var e=jQuery(this);e.hasClass("ajax-modified-cls")||(e.removeClass("cls4ajax"),e.html(t),e.attr("href",r),e.addClass("ajax-modified-cls"))})}else n.attr("href",a),n.addClass("ajax-modified-cls")},error:function(){n.addClass("ajax-error")}})};!function(r){try{var i=r.History}catch(e){console.log("History.js failed to load")}pageUsesTreeView()&&i.Adapter.bind(r,"statechange",function(){var e=null,t=null,a={},n=i.getState();if(jQuery(document).trigger("ont_view_change"),"undefined"!=typeof n.data.p)"classes"==n.data.p&&displayTree(n.data),showOntologyContent(n.data.p);else if("undefined"!=typeof n.url)if(""!=r.location.hash?(e=r.location.hash.split("?").pop().split("&"),jQuery(e).each(function(e,t){var n=t.split("=")[0],o=t.split("=")[1];a[n]=o})):(t=r.location.search.substring(1).split("&"),jQuery(t).each(function(e,t){var n=t.split("=")[0],o=t.split("=")[1];a[n]=o})),"undefined"!=typeof a.p&&content_section!=a.p)showOntologyContent(a.p),document.title=jQuery.bioportal.ont_pages[a.p].page_name+" | "+jQuery(document).data().bp.ont_viewer.org_site,content_section=null;else{var o=jQuery(document).data().bp.ont_viewer.content_section;showOntologyContent(o),document.title=jQuery.bioportal.ont_pages[o].page_name+" | "+jQuery(document).data().bp.ont_viewer.org_site}})}(window);var nav_ont=function(e){var t=jQuery(e).attr("data-bp-ont-page");History.pushState({p:t},jQuery.bioportal.ont_pages[t].page_name+" | "+jQuery(document).data().bp.ont_viewer.org_site,"?p="+t)};jQuery(document).ready(function(){var e=jQuery(document).data().bp.ont_viewer.metadata_only;if(pageUsesTreeView()||e!==undefined&&"false"!==e){var t=jQuery(document).data().bp.ont_viewer.content_section||"",n=jQuery(document).data().bp.ont_viewer.ontology_name,o=jQuery(document).data().bp.ont_viewer.org_site,a=jQuery.bioportal.ont_pages[t]||{},r=null==t?n+" | "+o:a.page_name+" | "+o;if(document.title=r,jQuery("#navbar-ontology a").on("click",function(e){e.preventDefault(),nav_ont(this)}),jQuery(".click_versions_collapse").click(function(){var e="#"+jQuery(this).parent().attr("id")+"_collapsible",t="#"+jQuery(this).parent().attr("id")+"_icon";jQuery(t).toggleClass("ui-icon-triangle-1-e"),jQuery(t).toggleClass("ui-icon-triangle-1-s"),jQuery(e).toggle()}),jQuery("#version_toggle").click(function(e){e.preventDefault(),jQuery("#ontology_versions tr.hidden_select").toggleClass("hidden_ont")}),jQuery("#version_toggle").toggle(function(){jQuery(this).text("less...")},function(){jQuery(this).text("more...")}),jQuery.bioportal.ont_pages[t].manuelRetrieve(jQuery("#ont_"+t+"_content").html()),jQuery.bioportal.ont_pages[t].published=!0,"function"==typeof jQuery.bioportal.ont_pages[t].init&&jQuery.bioportal.ont_pages[t].init(jQuery.bioportal.ont_pages[t]),jQuery("#ont-"+t+"-tab").tab("show"),"true"!=$.QueryString.skip_ajax_tabs){var i=e.toLowerCase().trim();"classes"!==t&&"true"!==i&&jQuery.bioportal.ont_pages.classes.retrieve(),"properties"!==t&&"true"!==i&&jQuery.bioportal.ont_pages.properties.retrieve(),"summary"!==t&&jQuery.bioportal.ont_pages.summary.retrieve(),"mappings"!==t&&"true"!==i&&jQuery.bioportal.ont_pages.mappings.retrieve(),"notes"!==t&&jQuery.bioportal.ont_pages.notes.retrieve(),"widgets"!==t&&"true"!==i&&jQuery.bioportal.ont_pages.widgets.retrieve()}}}),jQuery.bioportal.OntologyPage=function(e,t,n,o,a,r){this.id=e,this.location_path=t,this.error_string=n,this.page_name=o,this.error_string=n,this.nav_text=a,this.errored=!1,this.html,this.published=!1,this.retrieved=!1,this.init=r||null,this.retrieve=function(){jQuery.ajax({dataType:"html",url:this.location_path,context:this,success:function(e){this.html=e,this.retrieved=!0},error:function(){this.errored=!0,this.retrieved=!0}})},this.manuelRetrieve=function(e){this.html=e,this.retrieved=!0},this.retrieve_and_publish=function(){jQuery.ajax({dataType:"html",url:this.location_path,context:this,success:function(e){this.manuelRetrieve(e),this.publish()},error:function(){this.errored=!0,this.manuelRetrieve(null),this.publish()}})},this.publishAction=function(){jQuery("#ont_"+this.id+"_content").html(""),jQuery("#ont_"+this.id+"_content").html(this.html),document.title=jQuery.bioportal.ont_pages.classes.page_name+" | "+jQuery(document).data().bp.ont_viewer.org_site,"function"==typeof this.init&&this.init(this),jQuery.unblockUI(),this.published=!0},this.publish=function(){if(!1===this.errored){if(this.published)return;if(this.retrieved)this.publishAction();else var e=this,t=setInterval(function(){console.log("retrying!!! "+e.retrieved),e.retrieved&&(console.log("publishing!!!"),e.publishAction(),clearInterval(t))},100)}else jQuery("#ont_"+this.id+"_content").html(""),jQuery("#ont_"+this.id+"_content").html("<div style='padding: 1em;'>"+this.error_string+"</div>"),jQuery.unblockUI()}},window,jQuery.bioportal.ont_pages=[],jQuery.bioportal.ont_pages.classes=new jQuery.bioportal.OntologyPage("classes","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=classes&ajax=true"+jQuery(document).data().bp.ont_viewer.concept_param,"Problem retrieving classes",jQuery(document).data().bp.ont_viewer.ontology_name+jQuery(document).data().bp.ont_viewer.concept_name_title+" - Classes","Classes",function(){jQuery(document).data().bp.classesTab.search_box_init(),setupNotesFacebox()}),jQuery.bioportal.ont_pages.properties=new jQuery.bioportal.OntologyPage("properties","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=properties&ajax=true","Problem retrieving properties",jQuery(document).data().bp.ont_viewer.ontology_name+" - Properties","Properties",function(){jQuery(document).data().bp.ontPropertiesTab.init()}),jQuery.bioportal.ont_pages.summary=new jQuery.bioportal.OntologyPage("summary","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=summary&ajax=true","Problem retrieving summary",jQuery(document).data().bp.ont_viewer.ontology_name+" - Summary","Summary",function(){try{jQuery(document).data().bp.ontChart.init()}catch(e){console.log("No ontology visits data to display")}}),jQuery.bioportal.ont_pages.mappings=new jQuery.bioportal.OntologyPage("mappings","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=mappings&ajax=true","Problem retrieving mappings",jQuery(document).data().bp.ont_viewer.ontology_name+" - Mappings","Mappings",function(){jQuery(".facebox").facebox()}),jQuery.bioportal.ont_pages.notes=new jQuery.bioportal.OntologyPage("notes","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=notes&ajax=true","Problem retrieving notes",jQuery(document).data().bp.ont_viewer.ontology_name+" - Notes","Notes",function(){setupNotesFacebox(),jQuery("#ont_notes_content .link_button").button()}),jQuery.bioportal.ont_pages.widgets=new jQuery.bioportal.OntologyPage("widgets","/ontologies/"+jQuery(document).data().bp.ont_viewer.ontology_id+"?p=widgets&ajax=true","Problem retrieving widgets",jQuery(document).data().bp.ont_viewer.ontology_name+" - Widgets","Widgets"),jQuery(document).on("ajax:success",".facebox_review form",function(){location.reload()}),jQuery(document).ready(function(){setupNotesFaceboxSizing(),bindAddCommentClick(),bindAddProposalClick(),bindProposalChange(),bindReplyClick(),bindReplyCancelClick(),bindReplySaveClick(),jQuery("a.subscribe_to_notes").live("click",function(){subscribeToNotes(this)})}),NOTES_PROPOSAL_TYPES={ProposalNewClass:"New Class Proposal",ProposalChangeHierarchy:"New Relationship Proposal",ProposalChangeProperty:"Change Property Value Proposal"};var displayError=function(e){jQuery(e).parent().children(".reply_status").html("Error, please try again")},BP_INTERNAL_FORM_COMPLETE_LOADED=!0;if(void 0===BP_INTERNAL_SEARCH_SERVER)var BP_INTERNAL_SEARCH_SERVER=jQuery(document).data().bp.config.ui_url;if(void 0===BP_INTERNAL_SITE)var BP_INTERNAL_SITE="BioPortal";if(void 0===BP_INTERNAL_ORG)var BP_INTERNAL_ORG="NCBO";if(void 0===BP_INTERNAL_ONTOLOGIES)var BP_INTERNAL_ONTOLOGIES="";var BP_INTERNAL_ORG_SITE=""==BP_INTERNAL_ORG?BP_INTERNAL_SITE:BP_INTERNAL_ORG+" "+BP_INTERNAL_SITE;BP_INTERNAL_SEARCH_SERVER=determineHTTPS(BP_INTERNAL_SEARCH_SERVER),jQuery(document).ready(function(){jQuery('link[href$="'+BP_INTERNAL_SEARCH_SERVER+'/javascripts/JqueryPlugins/autocomplete/jquery.autocomplete.css"]')&&(jQuery("head").append("<link>"),css=jQuery("head").children(":last"),css.attr({rel:"stylesheet",type:"text/css",href:BP_INTERNAL_SEARCH_SERVER+"/javascripts/JqueryPlugins/autocomplete/jquery.autocomplete.css"})),jQuery.getScript(BP_INTERNAL_SEARCH_SERVER+"/javascripts/bp_crossdomain_autocomplete.js",function(){bp_internal_formComplete_setup_functions()})});var observer=new MutationObserver(function(e){e.forEach(function(e){if(0<e.addedNodes.length){var t=document.querySelector("#map_to_picker");null!=t&&resetAutocompleter(t.options[t.selectedIndex].value)}})});jQuery(document).ready(function(){var e=document.querySelector(".createNewMappingModal, .modal-body");null!=e&&observer.observe(e,{childList:!0}),jQuery("body").on("change","#map_to_picker",function(){resetAutocompleter(jQuery(this).val()),jQuery("#map_to_concept_details_table").html("")}),jQuery("input.search_autocomplete").live("autocomplete_selected",function(){var e=jQuery(this);e.val()!=e.attr("title")&&""!==e.val()&&getClassDetails(this)}),jQuery("input.search_autocomplete").blur(function(){var e=jQuery(this);setTimeout(function(){""!=e.val()&&e.val()!=e.attr("title")||jQuery("#"+e.attr("id")+"_concept_details").hide()},1)}),jQuery("input.search_autocomplete").each(function(){var e=jQuery(this);e.val()!=e.attr("title")&&""!=e.val()&&getClassDetails(this)}),jQuery(document).live("tree_changed",resetMappingUIWithFacebox),jQuery(document).live("classes_tab_visible",resetMappingUI),jQuery.facebox.settings.closeImage="/assets/facebox/closelabel-3792a485ee43385b7848dd725ae759c70fa7acd82328ffced4ab269ef3e5bb76.png",jQuery.facebox.settings.loadingImage="/assets/facebox/loading-81ea81be1d862d36c34b6dc4f12aefb87b656e319003263d8274974b48ccf869.gif",jQuery("#mappings_content a[rel*=facebox]").facebox(),jQuery("#create_mapping_button").live("click",bp_createMapping.create),$("#createNewMappingModal").on("shown.bs.modal",function(){var e=jQuery("#new_mapping_btn").data("concept-label");jQuery("h4#createNewMappingLabel").text("Create new mapping for: "+e)}),$("#createNewMappingModal").on("hidden.bs.modal",function(){jQuery("#map_to_concept_details").html(""),jQuery("#create_mapping_success_messages").html("")})});var bp_createMapping={create:function(){if(bp_createMapping.reset(),jQuery("#create_mapping_spinner").show(),bp_createMapping.validate())return jQuery("#create_mapping_spinner").hide(),!1;var e=jQuery("#map_from_bioportal_ontology_id"),t=jQuery("#map_to_bioportal_ontology_id"),n=jQuery("#map_from_bioportal_full_id"),o=jQuery("#map_to_bioportal_full_id"),a=jQuery("#mapping_comment"),r=jQuery("#mapping_relation"),i=jQuery("#mapping_bidirectional").is(":checked"),s={map_from_bioportal_ontology_id:e.val(),map_to_bioportal_ontology_id:t.val(),map_from_bioportal_full_id:n.val(),map_to_bioportal_full_id:o.val(),mapping_comment:a.val(),mapping_relation:r.val(),mapping_bidirectional:i};jQuery.ajax({url:"/mappings",type:"POST",data:s,success:bp_createMapping.success,error:bp_createMapping.error})},success:function(){var e=jQuery("#map_from_bioportal_ontology_id").val(),t=jQuery("#map_from_bioportal_full_id").val();if(jQuery("#create_mapping_spinner").hide(),jQuery("#create_mapping_success_messages").prepend(jQuery("<div/>").addClass("success_message").html("Mapping from <b>"+jQuery("#new_mapping_btn").data("concept-label")+"</b> to <b>"+jQuery("#map_to").val()+"</b> was created")),null!=document.getElementById("concept_mappings_table")){var n="/ajax/mappings/get_concept_table?ontologyid="+e+"&conceptid="+encodeURIComponent(t);jQuery("#concept_mappings_table").load(n,function(){jQuery("#mapping_count").html(jQuery("#mapping_details tbody tr:visible").size())})}jQuery.bioportal.ont_pages.mappings.retrieve_and_publish(),updateMappingDeletePermissions()},error:function(){jQuery("#create_mapping_spinner").hide(),jQuery("#create_mapping_error").html("There was a problem creating the mapping, please try again")},validate:function(){var e=jQuery("#map_to"),t=(jQuery("#create_mapping_error"),["<b>Problem creating mapping:</b>"]),n=!1;return""!=e.val()&&e.val()!=e.attr("title")||(t.push("Please select a target class"),n=!0),1<t.length&&jQuery("#create_mapping_error").html(t.join("<br/>")),n},reset:function(){jQuery("#create_mapping_error").html("")}};jQuery(document).ready(function(){(new SearchAnalytics).bindTracker()}),function(e){var t=e.History;"search"===currentPathArray()[0]&&t.Adapter.bind(e,"statechange",function(){t.getState();autoSearch()})}(window);var showAdditionalResults=function(e,t){var n=jQuery(e).attr("data-bp_ont");jQuery(t+n).toggleClass("not_visible"),jQuery(e).children(".hide_link").toggleClass("not_visible"),jQuery(e).toggleClass("not_underlined")},showAdditionalOntResults=function(e){e.preventDefault(),showAdditionalResults(this,"#additional_ont_results_")},showAdditionalClsResults=function(e){e.preventDefault(),showAdditionalResults(this,"#additional_cls_results_")},blacklistFixStrArr=[],blacklistSearchWordsArr=[],blacklistSearchWordsArrRegex=[],blacklistRegexArr=[],blacklistRegexMod="ig";blacklistFixStrArr.push("https://"),blacklistFixStrArr.push("http://"),blacklistFixStrArr.push("bioportal.bioontology.org/ontologies/"),blacklistFixStrArr.push("purl.bioontology.org/ontology/"),blacklistFixStrArr.push("purl.obolibrary.org/obo/"),blacklistFixStrArr.push("swrl.stanford.edu/ontologies/"),blacklistFixStrArr.push("mesh.owl"),blacklistRegexArr.push(new RegExp("abnormalities",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("biological",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("biology",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("bioontology",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("clinical",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("extension",blacklistRegexMod)),
blacklistRegexArr.push(new RegExp(".gov",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("ontology",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("ontologies",blacklistRegexMod)),blacklistRegexArr.push(new RegExp("semanticweb",blacklistRegexMod)),jQuery(document).ready(function(){jQuery("#search_categories").chosen({search_contains:!0,width:"432px"}),jQuery("#search_button").button({search_contains:!0}),jQuery("#search_button").click(function(){ajax_process_halt()}),jQuery("#search_keywords").click(function(){ajax_process_halt()}),jQuery("#search_spinner").hide(),jQuery("#search_keywords").focus(),jQuery("#search_select_ontologies").change(function(){jQuery(this).is(":checked")?jQuery("#ontology_picker_options").removeClass("not_visible"):(jQuery("#ontology_picker_options").addClass("not_visible"),jQuery("#ontology_ontologyId").val(""),jQuery("#ontology_ontologyId").trigger("chosen:updated"))}),jQuery("#search_results a.additional_ont_results_link").live("click",showAdditionalOntResults),jQuery("#search_results a.additional_cls_results_link").live("click",showAdditionalClsResults),jQuery("#advanced_options").on("click",toggleAdvancedSearchOptions),jQuery(document).live("search_results_updated",function(){jQuery("#ontologies_count_total").html(currentOntologiesCount()),updatePopupCounts(),jQuery("#ont_tooltip").tooltip({position:"bottom right",opacity:"90%",offset:[-18,5]})}),jQuery("#search_button").click(function(e){e.preventDefault(),History.pushState(currentSearchParams(),document.title,"/search?"+objToQueryString(currentSearchParams()))}),jQuery("#search_keywords").bind("keyup",function(e){13==e.which&&jQuery("#search_button").click()}),jQuery.facebox.settings.closeImage="/assets/facebox/closelabel-3792a485ee43385b7848dd725ae759c70fa7acd82328ffced4ab269ef3e5bb76.png",jQuery.facebox.settings.loadingImage="/assets/facebox/loading-81ea81be1d862d36c34b6dc4f12aefb87b656e319003263d8274974b48ccf869.gif",jQuery(document).bind("reveal.facebox",function(){jQuery("div.class_details_pop").is(":visible")&&jQuery("#facebox").css("max-height",jQuery(window).height()-2*(jQuery("#facebox").offset().top-jQuery(window).scrollTop())+"px")}),jQuery("a.class_visualize").live("click",function(){var e=jQuery(this).attr("data-bp_ontologyid"),t=jQuery(this).attr("data-bp_conceptid");jQuery("#biomixer").html('<iframe src="/ajax/biomixer/?ontology='+e+"&conceptid="+encodeURIComponent(t)+'" frameborder=0 height="500px" width="500px" scrolling="no"></iframe>').show(),jQuery.facebox({div:"#biomixer"})}),jQuery("#search-help").on("click",bpPopWindow),autoSearch()});var sortStringFunction=function(e,t){var n=String(e).toLowerCase(),o=String(t).toLowerCase();return n<o?-1:o<n?1:0},bp_last_params=null,annotationsTable=null,annotator_ontologies=null,BP_CONFIG=jQuery(document).data().bp.config,BP_COLUMNS={classes:0,ontologies:1,types:2,sem_types:3,matched_classes:5,matched_ontologies:6},CONCEPT_MAP={mapping:"mappedConcept",mgrep:"concept",closure:"concept"},displayFilteredColumnNames=function(){"use strict";var e,t=[];jQuery(".bp_popup_list input:checked").closest("th").each(function(){e=this.childNodes[0].textContent.trim(),t.push(e)}),jQuery("#filter_names").html(t.join(", ")),0<t.length?jQuery("#filter_list").show():jQuery("#filter_list").hide()},filter_ontologies={init:function(){"use strict";jQuery("#filter_ontologies").bind("click",function(e){bp_popup_init(e)}),jQuery(".filter_ontology_checkboxes").bind("click",function(e){filter_ontologies.filterOntology(e)}),jQuery("#ontology_filter_list").click(function(e){e.stopPropagation()}),this.cleanup()},cleanup:function(){"use strict";jQuery("html").click(bp_popup_cleanup),jQuery(document).keyup(function(e){27==e.keyCode&&bp_popup_cleanup()})},filterOntology:function(e){"use strict";e.stopPropagation();var t=[];jQuery(".filter_ontology_checkboxes:checked").each(function(){t.push(jQuery(this).val())}),displayFilteredColumnNames(),0===t.length?annotationsTable.fnFilter("",BP_COLUMNS.ontologies):annotationsTable.fnFilter(t.join("|"),BP_COLUMNS.ontologies,!0,!1)}},filter_classes={init:function(){"use strict";jQuery("#filter_classes").bind("click",function(e){bp_popup_init(e)}),jQuery(".filter_classes_checkboxes").bind("click",function(e){filter_classes.filterClasses(e)}),jQuery("#classes_filter_list").click(function(e){e.stopPropagation()}),this.cleanup()},cleanup:function(){"use strict";jQuery("html").click(bp_popup_cleanup),jQuery(document).keyup(function(e){27==e.keyCode&&bp_popup_cleanup()})},filterClasses:function(e){"use strict";e.stopPropagation();var t=[];jQuery(".filter_classes_checkboxes:checked").each(function(){t.push(jQuery(this).val().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))}),displayFilteredColumnNames(),0===t.length?annotationsTable.fnFilter("",BP_COLUMNS.classes):annotationsTable.fnFilter("^"+t.join("(?!.)|^")+"(?!.)",BP_COLUMNS.classes,!0,!1)}},filter_matched_ontologies={init:function(){"use strict";jQuery("#filter_matched_ontologies").bind("click",function(e){bp_popup_init(e)}),jQuery(".filter_matched_ontology_checkboxes").bind("click",function(e){filter_matched_ontologies.filter(e)}),jQuery("#ontology_matched_filter_list").click(function(e){e.stopPropagation()}),this.cleanup()},cleanup:function(){"use strict";jQuery("html").click(bp_popup_cleanup),jQuery(document).keyup(function(e){27==e.keyCode&&bp_popup_cleanup()})},filter:function(e){"use strict";e.stopPropagation();var t=[];jQuery(".filter_matched_ontology_checkboxes:checked").each(function(){t.push(jQuery(this).val())}),displayFilteredColumnNames(),0===t.length?annotationsTable.fnFilter("",BP_COLUMNS.matched_ontologies):annotationsTable.fnFilter(t.join("|"),BP_COLUMNS.matched_ontologies,!0,!1)}},filter_matched_classes={init:function(){"use strict";jQuery("#filter_matched_classes").bind("click",function(e){bp_popup_init(e)}),jQuery(".filter_matched_classes_checkboxes").bind("click",function(e){filter_matched_classes.filter(e)}),jQuery("#matched_classes_filter_list").click(function(e){e.stopPropagation()}),this.cleanup()},cleanup:function(){"use strict";jQuery("html").click(bp_popup_cleanup),jQuery(document).keyup(function(e){27==e.keyCode&&bp_popup_cleanup()})},filter:function(e){"use strict";e.stopPropagation();var t=[];jQuery(".filter_matched_classes_checkboxes:checked").each(function(){t.push(jQuery(this).val().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))}),displayFilteredColumnNames(),0===t.length?annotationsTable.fnFilter("",BP_COLUMNS.matched_classes):annotationsTable.fnFilter("^"+t.join("(?!.)|^")+"(?!.)",BP_COLUMNS.matched_classes,!0,!1)}},filter_match_type={init:function(){"use strict";jQuery("#filter_match_type").bind("click",function(e){bp_popup_init(e)}),jQuery(".filter_match_type_checkboxes").bind("click",function(e){filter_match_type.filterMatchType(e)}),jQuery("#match_type_filter_list").click(function(e){e.stopPropagation()}),this.cleanup()},cleanup:function(){"use strict";jQuery("html").click(bp_popup_cleanup),jQuery(document).keyup(function(e){27==e.keyCode&&bp_popup_cleanup()})},filterMatchType:function(e){"use strict";e.stopPropagation();var t=[];jQuery(".filter_match_type_checkboxes:checked").each(function(){t.push(jQuery(this).val().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))}),displayFilteredColumnNames(),0===t.length?annotationsTable.fnFilter("",BP_COLUMNS.types):annotationsTable.fnFilter("^"+t.join("(?!.)|^")+"(?!.)",BP_COLUMNS.types,!0,!1)}},removeFilters=function(){"use strict";jQuery(".filter_ontology_checkboxes").attr("checked",!1),jQuery(".filter_classes_checkboxes").attr("checked",!1),jQuery(".filter_match_type_checkboxes").attr("checked",!1),jQuery(".filter_matched_classes_checkboxes").attr("checked",!1),jQuery(".filter_matched_ontologies_checkboxes").attr("checked",!1),annotationsTable.fnFilter("",BP_COLUMNS.classes),annotationsTable.fnFilter("",BP_COLUMNS.ontologies),annotationsTable.fnFilter("",BP_COLUMNS.types),annotationsTable.fnFilter("",BP_COLUMNS.matched_classes),annotationsTable.fnFilter("",BP_COLUMNS.matched_ontologies),jQuery("#filter_list").hide()};jQuery.fn.dataTableExt.oApi.fnSortNeutral=function(e){"use strict";e.aaSorting=[],e.aiDisplay.sort(function(e,t){return e-t}),e.aiDisplayMaster.sort(function(e,t){return e-t}),e.oApi._fnReDraw(e)},jQuery(document).ready(function(){"use strict";jQuery("#annotator_button").click(get_annotations),jQuery("#semantic_types").chosen({search_contains:!0}),jQuery("#insert_text_link").click(insertSampleText),annotationsTable=jQuery("#annotations").dataTable({bPaginate:!1,bAutoWidth:!1,aaSorting:[],oLanguage:{sZeroRecords:"No annotations found"},aoColumns:[{sWidth:"15%"},{sWidth:"15%"},{sWidth:"5%"},{sWidth:"5%",bVisible:!1},{sWidth:"30%"},{sWidth:"15%"},{sWidth:"15%"}]}),filter_ontologies.init(),filter_classes.init(),filter_match_type.init(),filter_matched_ontologies.init(),filter_matched_classes.init(),jQuery("#annotator-help").on("click",bpPopWindow),jQuery("#annotations_container").hide()}),function(e){var t=e.History;"resource_index"===currentPathArray()[0]&&t.Adapter.bind(e,"statechange",function(){var e=t.getState();"undefined"!=typeof e.data.route?router.route(e.data.route,e.data):router.route("index")})}(window);var uri_split_chars="\t::\t",uri_split=function(e){return e.split(uri_split_chars)},bpResourceIndexEmbedded=!1;jQuery(document).ready(function(){function t(e){return"<span>"+e.prefLabel+" ("+e.ontologyName+")</span>"}function e(e){return e.loading?e.text:t(e)}function n(e){return t(e)}bpResourceIndexEmbedded=0<jQuery("#resource_table").parents("div.resource_index_embed").length,jQuery(".resource_link").live("click",function(e){e.preventDefault(),switchResources(this)}),jQuery("#resource_index_advanced_options").on("click",function(){jQuery("#search_options").toggleClass("not_visible"),jQuery("#hide_advanced_options").toggleClass("not_visible")}),jQuery(".pagination a").live("click",function(){jQuery(this).parents("div.pagination").append('&nbsp;&nbsp; <span style="font-size: small; font-weight: normal;">loading</span> <img style="vertical-align: text-bottom;" src="/assets/spinners/spinner_000000_16px-4f45a5c270658c15e01139159c3bfca130a7db43c921af9fe77dc0cce05132bf.gif" alt="Spinner 000000 16px" />')}),jQuery("#resources_desc").dataTable({paging:!1,searching:!1,columns:[{type:"html"},{orderable:!1},{type:"num-fmt",orderSequence:["desc","asc"]},{orderSequence:["desc","asc"]}]}),jQuery("#resource_index_classes").select2({allowClear:!0,placeholder:"Start typing to find classes to search the index with",escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:e,templateSelection:n,ajax:{url:jQuery(document).data().bp.config.rest_url+"/search",dataType:"json",delay:500,data:function(e){var t=e.term;return/[^*]$/.test(t)&&(t+="*"),{q:t,apikey:jQuery(document).data().bp.config.apikey,ontologies:currentOntologyAcronyms().join(","),page:e.page}},processResults:function(e,t){return t.page=e.page||1,{results:$.map(e.collection,function(e){var t=e.links.ontology,n=t.split("/").slice(-1)[0],o=e["@id"];return{id:t+uri_split_chars+o,prefLabel:e.prefLabel,ontologyName:n}}),pagination:{more:e.page<=e.pageCount}}},cache:!0}}),jQuery("#resource_index_classes").on("select2:unselect",function(){jQuery("#resource_index_classes").val()||pushIndex()}),0<jQuery("#resource_index_button").length&&jQuery("#resource_index_button").click(function(){pushDisplayResources("/resource_index/resources?"+chosenSearchClassesArgs(),{classes:chosenSearchClasses()}),getSearchResults()}),jQuery("#show_hide_no_results").live("click",function(){jQuery("#resource_table .zero_results").toggleClass("not_visible").effect("highlight",{color:"yellow"},500),jQuery("#show_hide_no_results .show_hide_text").toggleClass("not_visible")}),jQuery(".show_element_details").live("click",function(e){e.preventDefault();var t=jQuery(this),n=t.data().cleanElementId,o=jQuery("#"+n+"_text");if(o.toggleClass("not_visible"),"true"!==o.attr("highlighted")){var a=new Element(t.data().elementId,n,chosenSearchClasses(),t.data().resourceId);t.parent().append('<span id="'+a.cleanId+'_ani" class="highlighting">highlighting... <img style="vertical-align: text-bottom;" src="/assets/spinners/spinner_000000_16px-4f45a5c270658c15e01139159c3bfca130a7db43c921af9fe77dc0cce05132bf.gif" alt="Spinner 000000 16px" /></span>'),a.highlightAnnotationPositions(),o.attr("highlighted","true")}}),jQuery("#resource-index-help").on("click",bpPopWindow)});var BP_urlParams={};!function(){var e,t,n,o=/\+/g,a=/([^&=]+)=?([^&]*)/g,r=function(e){return decodeURIComponent(e.replace(o," "))},i=window.location.search.substring(1);for(queryH=window.location.hash.substring(1);e=a.exec(i);)(t=/^(\w+)\[(.*)\]$/.exec(e[1]))?((n=BP_urlParams[t[1]])===undefined&&(n={}),n[r(t[2])]===undefined&&(n[r(t[2])]=[]),n[r(t[2])]=r(e[2]).split(","),BP_urlParams[t[1]]=n):BP_urlParams[r(e[1])]=r(e[2]);for(;e=a.exec(queryH);)(t=/^(\w+)\[(.*)\]$/.exec(e[1]))?((n=BP_urlParams[t[1]])===undefined&&(n={}),n[r(t[2])]===undefined&&(n[r(t[2])]=[]),n[r(t[2])]=r(e[2]).split(","),BP_urlParams[t[1]]=n):BP_urlParams[r(e[1])]=r(e[2])}();var bp_classes_cache={};jQuery(document).ready(function(){setInterval(function(){lookupClassLabels()},1e3)}),router=new Router,jQuery("a.results_link").live("click",function(){var e=jQuery(this).data().resourceId;pushDisplayResource("/resource_index/resources/"+e+"?"+chosenSearchClassesArgs(),{classes:chosenSearchClasses(),acronym:e})}),jQuery("a#show_all_resources").live("click",function(){pushDisplayResources("/resource_index/resources?"+chosenSearchClassesArgs(),{classes:chosenSearchClasses()})}),jQuery(document).ready(function(){updateMappingCount(),updateMappingDeletePermissions(),jQuery("#search_ontologies").chosen({search_contains:!0}),jQuery("#display_options input").on("click",function(){var e=jQuery("#search_ontologies").val();""!==e&&loadMappings(e)}),jQuery("#mappings-help").on("click",bpPopWindow)}),jQuery(document).bind("tree_changed",updateMappingCount),function(){function t(e){if((jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" /> Loading Class...</h1>',showOverlay:!1}),null==e)&&confirm("Class could not be found.\n\nPress OK to go to the Search page or Cancel to continue browsing"))return jQuery("#search_keyword").val(jQuery("#search_box").val()),void jQuery("#search_form").submit();if(e.extra){var t=jQuery("#jump_to_concept_id").val();return document.location="/ontologies/"+jQuery(document).data().bp.ontology.acronym+"/?p=classes&conceptid="+encodeURIComponent(t)+"&jump_to_nav=true",void jQuery.blockUI({message:'<h1><img src="/assets/jquery.simple.tree/spinner-d3e3944d4649450dee66a55c69eeced2d825b6ca1a349f72c75fd3780ae3f006.gif" /> Loading Class...</h1>',showOverlay:!1})}}function e(e){jQuery("#jump_to_concept_id").val(e.extra[0]),t(e)}function n(e){var t=new RegExp("[.*+?|()\\[\\]{}\\\\]","g"),n=jQuery("#search_box").val().trim().replace(t,"\\$&").split(" ").join("|"),o=new RegExp("("+n+")","gi"),a="";if("undefined"!=typeof e[2]&&""!==e[2]&&(a=" <span style='font-size:9px;color:blue;'>("+e[2]+")</span>"),null==e[0].match(o)){var r=e[6].split("\t")[0]||"";if(""!==(r=r.split(";"))){var i=jQuery.grep(r,function(e){return null!=e.match(o)});e[0]=e[0]+" (synonym: "+i.join(" ")+")"}}-1!=e[0].indexOf("[obsolete]")?(e[0]=e[0].replace("[obsolete]",""),obsolete_prefix="<span class='obsolete_class' title='obsolete class'>",obsolete_suffix="</span>"):(obsolete_prefix="",obsolete_suffix="");var s=e[0].replace(o,"<b><span style='color:#006600;'>$1</span></b>");return obsolete_prefix+s+a+obsolete_suffix}function a(e){var t=document.getElementById(e+"_content");null!=t&&(jQuery(".tab_container").addClass("not_visible"),jQuery(t).removeClass("not_visible"),jQuery(".tab").removeClass("selected"),jQuery("#"+e+"_top").addClass("selected"),jQuery(document).trigger("classes_tab_visible")),jQuery(document).trigger("visualize_tab_change",[{tabType:e}])}var o=currentPathArray();"ontologies"!==o[0]||"ontologies"===o[0]&&2!==o.length||(jQuery(document).data().bp.classesTab={},jQuery(".tab").live("click",function(){a(jQuery(this).children("a:first").attr("href").replace("#",""))}),jQuery(document).live("visualize_tab_change",function(e,t){"visualization"==t.tabType&&jQuery("#biomixer_iframe").attr("src",jQuery("#biomixer_iframe").data("src"))}),jQuery(document).data().bp.classesTab.search_box_init=function(){jQuery("#search_box").bioportal_autocomplete&&jQuery("#search_box").bioportal_autocomplete("/search/json_search/"+jQuery(document).data().bp.ontology.acronym,{extraParams:{objecttypes:"class"},selectFirst:!0,lineSeparator:"~!~",matchSubset:0,minChars:1,maxItemsToShow:25,onFindValue:t,onItemSelect:e,formatItem:n})},jQuery(document).ready(function(){var e,t,n=document.URL,o={};if(0<n.indexOf("?")){for(param in e=n.split("?")[1].split("&"))1<(t=e[param].split("=")).length&&(o[t[0]]=t[1].split("#")[0]);"undefined"!==o&&"t"in o&&a(o.t)}jQuery("#classPermalinkModal").on("shown.bs.modal",function(){var e=jQuery("a.class-permalink").data("current-purl");jQuery("#purl_input").val(e)}),jQuery("#purl_input").on("click",function(){jQuery(this).select()})}))}(window);var DUMMY_ONTOLOGY="DUMMY_ONT";window.BP_CONFIG===undefined&&(window.BP_CONFIG=jQuery(document).data().bp.config);var problemOnly=!0,AjaxAction=function(e,t,n,o,a){a=a||{},this.httpMethod=e,this.operation=t,this.path=n,this.isLongOperation=o,this.ontologies=[DUMMY_ONTOLOGY],this.isProgressMessageEnabled=!0,a.ontologies&&(this.ontologies=a.ontologies.split(","),delete a.ontologies),this.params=a,this.confirmMsg="Are you sure?"};AjaxAction.prototype.setConfirmMsg=function(e){this.confirmMsg=e},AjaxAction.prototype.setProgressMessageEnabled=function(e){this.isProgressMessageEnabled=e},AjaxAction.prototype.clearStatusMessages=function(){jQuery("#progress_message").hide(),jQuery("#success_message").hide(),jQuery("#error_message").hide(),jQuery("#info_message").hide(),jQuery("#progress_message").html(""),jQuery("#success_message").html(""),jQuery("#error_message").html(""),jQuery("#info_message").html("")},AjaxAction.prototype.showProgressMessage=function(){this.clearStatusMessages();var e="Performing "+this.operation;this.ontologies[0]!==DUMMY_ONTOLOGY&&(e+=" for "+this.ontologies.join(", ")),jQuery("#progress_message").text(e).html(),jQuery("#progress_message").show()},AjaxAction.prototype.showStatusMessages=function(e,t,n,o){_showStatusMessages(e,t,n,o)},AjaxAction.prototype.getSelectedOntologiesForDisplay=function(){var e="";0<this.ontologies.length&&(e="<br style='margin-bottom:5px;'/><span style='color:red;font-weight:bold;'>"+this.ontologies.join(", ")+"</span><br/>");return e},AjaxAction.prototype._ajaxCall=function(){var l=this,c=[],u=[],d=[],n=[],o=jQuery.extend(!0,{},l.params);l.isProgressMessageEnabled&&l.showProgressMessage(),jQuery.each(l.ontologies,function(e,r){r!=DUMMY_ONTOLOGY&&(o.ontologies=r);var i=jQuery.Deferred();l.isLongOperation||i.resolve(),n.push(i);var s=!1,t=jQuery.ajax({method:l.httpMethod,url:"/admin/"+l.path,data:o,dataType:"json",success:function(e){var t=/\s*,\s*/g;if(e.errors){s=!0;var n=e.errors.replace(t,",");u.push.apply(u,n.split(",")),l.onErrorAction(u),"pending"===i.state()&&i.resolve()}if(e.success){if(l.onSuccessAction(e,r,i),e.success){var o=e.success.replace(t,",");c.push.apply(c,o.split(","))}if(e.notices){var a=e.notices.replace(t,",");d.push.apply(d,a.split(","))}}l.showStatusMessages(c,u,d,!1)},error:function(e,t,n){s=!0,u.push(e.status+": "+n),l.onErrorAction(u),l.showStatusMessages(c,u,d,!1)},complete:function(){!s&&l.isLongOperation||l.removeSelectedRow(r)}});n.push(t)}),jQuery.when.apply(null,n).always(function(){jQuery("#progress_message").hide(),jQuery("#progress_message").html("")})},AjaxAction.prototype.removeSelectedRow=function(e){e!=DUMMY_ONTOLOGY&&jQuery("#tr_"+e).removeClass("selected")},AjaxAction.prototype.ajaxCall=function(){var t=this;0!==t.ontologies.length?t.confirmMsg?alertify.confirm(t.confirmMsg,function(e){e&&t._ajaxCall()}):t._ajaxCall():alertify.alert("Please select at least one ontology from the table to perform action on.<br/>To select/de-select ontologies, simply click anywhere in the ontology row.")},AjaxAction.prototype.onSuccessAction=function(e,o,a){var r=this;if(r.isLongOperation){var t=e.process_id,i=[],s=[],l=[];e.success="";var n=(new Date).getTime(),c=setInterval(function(){jQuery.ajax({url:determineHTTPS(BP_CONFIG.rest_url)+"/admin/ontologies_report/"+t,data:{apikey:BP_CONFIG.apikey,userapikey:BP_CONFIG.userapikey,format:"jsonp"},dataType:"jsonp",timeout:3e4,success:function(e){if("string"==typeof e)jQuery("#progress_message").append(".");else{if(-1!=jQuery.inArray(o,l))return;if(l.push(o),clearInterval(c),e.errors&&0<e.errors.length)s[0]=e.errors[0];else{var t=(new Date).getTime()-n;i[0]=o===DUMMY_ONTOLOGY?r.operation+" completed in "+millisToMinutesAndSeconds(t):r.operation+" for "+o+" completed in "+millisToMinutesAndSeconds(t),r.onSuccessActionLongOperation(e,o)}a.resolve(),r.showStatusMessages(i,s,[],!0)}},error:function(e,t,n){-1==jQuery.inArray(o,l)&&(l.push(o),clearInterval(c),s.push(e.status+": "+n),a.resolve(),r.showStatusMessages(i,s,[],!0))}})},5e3)}},AjaxAction.prototype.onErrorAction=function(){},AjaxAction.prototype.onSuccessActionLongOperation=function(){},AjaxAction.prototype.setSelectedOntologies=function(){var t="";jQuery("#adminOntologies").DataTable().rows(".selected").every(function(){var e=this.node().id;t+=e.substring("tr_".length)+","}),t.length?this.ontologies=t.slice(0,-1).split(","):this.ontologies=[]},AjaxAction.prototype.act=function(){alert("AjaxAction.act is not implemented")},ResetMemcacheConnection.prototype=Object.create(AjaxAction.prototype),(ResetMemcacheConnection.prototype.constructor=ResetMemcacheConnection).act=function(){(new ResetMemcacheConnection).ajaxCall()},FlushMemcache.prototype=Object.create(AjaxAction.prototype),(FlushMemcache.prototype.constructor=FlushMemcache).act=function(){(new FlushMemcache).ajaxCall()},ClearGooCache.prototype=Object.create(AjaxAction.prototype),(ClearGooCache.prototype.constructor=ClearGooCache).act=function(){(new ClearGooCache).ajaxCall()},ClearHttpCache.prototype=Object.create(AjaxAction.prototype),(ClearHttpCache.prototype.constructor=ClearHttpCache).act=function(){(new ClearHttpCache).ajaxCall()},DeleteSubmission.prototype=Object.create(AjaxAction.prototype),(DeleteSubmission.prototype.constructor=DeleteSubmission).prototype.onSuccessAction=function(e,t){jQuery.facebox({ajax:"/admin/ontologies/"+t+"/submissions?time="+(new Date).getTime()})},DeleteSubmission.act=function(e,t){new DeleteSubmission(e,t).ajaxCall()},RefreshReport.prototype=Object.create(AjaxAction.prototype),(RefreshReport.prototype.constructor=RefreshReport).prototype.onSuccessActionLongOperation=function(e,t){displayOntologies(e,t)},RefreshReport.act=function(){(new RefreshReport).ajaxCall()},DeleteOntologies.prototype=Object.create(AjaxAction.prototype),(DeleteOntologies.prototype.constructor=DeleteOntologies).prototype.onSuccessAction=function(e,t){jQuery("#adminOntologies").DataTable().row(jQuery("#tr_"+t)).remove().draw()},DeleteOntologies.act=function(){(new DeleteOntologies).ajaxCall()},ProcessOntologies.prototype=Object.create(AjaxAction.prototype),(ProcessOntologies.prototype.constructor=ProcessOntologies).act=function(e){new ProcessOntologies(e).ajaxCall()},UpdateCheck.prototype=Object.create(AjaxAction.prototype),(UpdateCheck.prototype.constructor=UpdateCheck).prototype.onSuccessAction=function(e){var t=this;if(delete e.success,updateInfo=e.update_info,updateInfo.update_check_enabled){var n="";if(updateInfo.date_checked){var o=parseReportDate(updateInfo.date_checked);o&&(n="Last update check on: "+o)}updateInfo.update_available?(e.notices="Update available. You are running the version: "+updateInfo.current_version+". Updated version: "+updateInfo.update_version+".",n&&(e.notices+=" "+n+"."),updateInfo.notes&&(e.notices+=" Update notes: "+updateInfo.notes)):t.params&&t.params.force_check?(e.notices="No update available. You are running the latest version: "+updateInfo.current_version+".",n&&(e.notices+=" "+n+".")):delete e.notices}},UpdateCheck.prototype.onErrorAction=function(e){var t=this;t.params&&t.params.force_check||(e.length=0)},UpdateCheck.isUpdateCheckEnabled=!1,UpdateCheck.act=function(t){UpdateCheck.isUpdateCheckEnabled?new UpdateCheck(t).ajaxCall():jQuery.ajax({url:"/admin/update_check_enabled",success:function(e){e?(jQuery("#update_check").show(),new UpdateCheck(t).ajaxCall(),UpdateCheck.isUpdateCheckEnabled=!0):jQuery("#update_check").hide()},error:function(){console.log("An error occurred while performing a check for the latest version.")}})},jQuery(".admin.index").ready(function(){displayOntologies({},DUMMY_ONTOLOGY),UpdateCheck.act(),jQuery(document).bind("beforeReveal.facebox",function(){jQuery("#facebox .content").empty()}),jQuery(document).bind("reveal.facebox",function(){jQuery("div[id=facebox]:hidden").remove()}),jQuery(document).bind("loading.facebox",function(){jQuery(document).unbind("keydown.facebox"),jQuery("#facebox_overlay").unbind("click")}),jQuery("div.ontology_nav").html('<span class="toggle-row-display">'+showOntologiesToggleLinks(problemOnly)+'</span><span style="padding-left:30px;">Apply to Selected Rows:&nbsp;&nbsp;&nbsp;&nbsp;<select id="admin_action" name="admin_action"><option value="">Please Select</option><option value="delete">Delete</option><option value="all">Process</option><option value="process_annotator">Annotate</option><option value="diff">Diff</option><option value="index_search">Index</option><option value="run_metrics">Metrics</option></select>&nbsp;&nbsp;&nbsp;&nbsp;<a class="link_button ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" href="javascript:;" id="admin_action_submit"><span class="ui-button-text">Go</span></a></span>'),jQuery.fn.dataTable.ext.search.push(function(e,t,n){if(!e.oInit.customAllowOntologiesFilter)return!0;var o=e.aoData[n].nTr;return!(problemOnly&&!o.classList.contains("problem")&&"true"!==t[t.length-1])}),jQuery(".toggle-row-display a").live("click",function(){return toggleShow(!problemOnly),jQuery("#adminOntologies").DataTable().draw(),str=showOntologiesToggleLinks(problemOnly),jQuery(".toggle-row-display").html(str),!1}),jQuery("#adminOntologies tbody").on("click","tr",function(e){"a"!=e.target.tagName.toLowerCase()&&jQuery(this).toggleClass("selected")}),jQuery("#admin_action_submit").click(function(){performActionOnOntologies()}),jQuery("#flush_memcache_action").click(function(){FlushMemcache.act()}),jQuery("#reset_memcache_connection_action").click(function(){ResetMemcacheConnection.act()}),jQuery("#flush_goo_cache_action").click(function(){ClearGooCache.act()}),jQuery("#flush_http_cache_action").click(function(){ClearHttpCache.act()}),jQuery("#refresh_report_action").click(function(){RefreshReport.act()}),jQuery("#update_check_action").click(function(){UpdateCheck.act(!0)}),jQuery("ul.admin_tabs").tabs("div.admin_panes > div")});var rec={maxInputWords:500,showOrHideAdvancedOptions:function(){$("#advancedOptions").toggle();var e=$("#advancedOptions").is(":visible")?"Hide advanced options <<":"Show advanced options >>";$("#advancedOptionsLink").text(e)},insertInput:function(e){e.preventDefault(),rec.prepareForRealInput(),$("#radioItText").is(":checked")?rec.insertSampleText():rec.insertSampleKeywords()},defaultMessage:!0,prepareForRealInput:function(){rec.emptyInput=!1,1==rec.defaultMessage&&($("#inputText").val(""),rec.defaultMessage=!1)},enableEdition:function(){$("#inputText").show(),$("#inputTextHighlighted").hide(),$("#resultsHeader").empty(),$("#recommender-results").empty(),$("#editButton").hide(),$("#recommenderButton").show(),$("#insertInputLink").show(),$("input[name=input_type]").attr("disabled",!1)},insertSampleText:function(){rec.enableEdition();var e='Primary treatment of DCIS now includes 3 options: lumpectomy without lymph node surgery plus whole breast radiation (category 1); total mastectomy with or without sentinel node biopsy with or without reconstruction (category 2A); lumpectomy without lymph node surgery without radiation (category 2B). Workup for patients with clinical stage l, llA, llB, or T3,N1,M0 disease was reorganized to distinguish optional additional studies from those recommended for all of these patients. Recommendation for locoregional treatment for patients with clinical stage l, llA, llB, or T3,N1,M0 disease with 1-3 positive axillary nodes following total mastectomy was changed from "Consider" to "Strongly consider" postmastectomy radiation therapy. ';jQuery("#inputText").focus(),jQuery("#inputText").val(e),$(".notTextError").hide(),$("#radioItText").prop("checked",!0)},insertSampleKeywords:function(){rec.enableEdition();var e="Backpain, White blood cell, Carcinoma, Cavity of stomach, Ductal Carcinoma in Situ, Adjuvant chemotherapy, Axillary lymph node staging, Mastectomy, tamoxifen, serotonin reuptake inhibitors, Invasive Breast Cancer, hormone receptor positive breast cancer, ovarian ablation, premenopausal women, surgical management, biopsy of breast tumor, Fine needle aspiration, entinel lymph node, breast preservation, adjuvant radiation therapy, prechemotherapy, Inflammatory Breast Cancer, ovarian failure, Bone scan, lumpectomy, brain metastases, pericardial effusion, aromatase inhibitor, postmenopausal, Palliative care, Guidelines, Stage IV breast cancer disease, Trastuzumab, Breast MRI examination";jQuery("#inputText").focus(),jQuery("#inputText").val(e),$(".notTextError").hide(),$("#radioItKeywords").prop("checked",!0)},colors:["#234979","#cc0000","#339900","#ff9900"],getHighlightedTerms:function(e,t){for(var n=document.getElementById("inputText").value,o="",a=0,r=[],i=0;i<e[t].ontologies.length;i++)r[i]=e[t].ontologies[i]["@id"];for(var s=0;s<e[t].coverageResult.annotations.length;s++){var l=e[t].coverageResult.annotations[s].from-1,c=e[t].coverageResult.annotations[s].to,u=n.substring(l,c),d=e[t].coverageResult.annotations[s].annotatedClass.links.ontology;if(1==e[t].ontologies.length)var p=rec.colors[0];else{var h=r.indexOf(d);p=rec.colors[h]}var _='<a style="font-weight: bold; color:'+p+'" target="_blank" href='+bp_cls_link(e[t].coverageResult.annotations[s].annotatedClass["@id"],d.slice(d.lastIndexOf("/")+1))+">"+u+"</a>";a<l&&(o+=n.substring(a,l)),o+=_,a=c}return a<n.length&&(o+=n.substring(a,n.length)),o},hideErrorMessages:function(){$(".generalError").hide(),$(".inputSizeError").hide(),$(".invalidWeightsError").hide(),$(".rangeWeightsError").hide(),$(".sumWeightsError").hide(),$(".maxOntologiesError").hide(),$(".invalidMaxOntError").hide(),$(".notTextError").hide(),$("#noResults").hide(),$("#noResultsSets").hide()},getRecommendations:function(){rec.hideErrorMessages();var e=!1;0!=$("#inputText").val().length&&1!=rec.emptyInput||($(".notTextError").show(),e=!0),$("#inputText").val().split(" ").length>rec.maxInputWords&&($(".inputSizeError").show(),e=!0);var t=parseFloat($("#input_wc").val()),n=parseFloat($("#input_wa").val()),o=parseFloat($("#input_wd").val()),a=parseFloat($("#input_ws").val());(isNaN(t)||isNaN(n)||isNaN(o)||isNaN(a))&&($(".invalidWeightsError").show(),e=!0),(t<0||n<0||o<0||a<0)&&($(".rangeWeightsError").show(),e=!0),t+n+o+a<=0&&($(".sumWeightsError").show(),e=!0);var r=parseInt($("#input_max_ontologies").val());if((isNaN(r)||r%1!=0)&&($(".invalidMaxOntError").show(),e=!0),(r<2||4<r)&&($(".maxOntologiesError").show(),e=!0),!e){rec.hideErrorMessages(),$(".recommenderSpinner").show();var _={},i=jQuery("#ontology_ontologyId");_.input=$("#inputText").val(),_.ontologies=null===i.val()?[]:i.val(),$("#radioItText").is(":checked")?_.input_type=1:_.input_type=2,$("#radioOtSingle").is(":checked")?_.output_type=1:_.output_type=2,_.wc=$("#input_wc").val(),_.wa=$("#input_wa").val(),_.wd=$("#input_wd").val(),_.ws=$("#input_ws").val(),_.max_elements_set=$("#input_max_ontologies").val(),$.ajax({type:"POST",url:"/recommender",data:_,dataType:"json",success:function(a){if($(".recommenderSpinner").hide(),a)if(0<a.length){if($("#recommender-results").empty(),$("#resultsHeader").text("Recommended ontologies"),1==_.output_type)var e="Ontology";else e="Ontologies";var t=$('<table id="recommendations" class="zebra" width="100%"></table>'),n=$(
'<thead><tr><th title="Position of the ontology in the ranking">POS.</th><th title="Ontology acronym">'+e+'</th><th title="Final recommendation score for the ontology. It represents the appropriateness of the ontology to describe the input data">Final score</th><th title="The coverage score represents the extent to what the ontology covers the input data">Coverage score</th><th title="The acceptance score represents how well known and trusted is the ontology by the biomedical community">Acceptance score</th><th title="The detail score represents the richness of the ontology representation for the input data">Detail score</th><th title="The specialization score represents the level of specialization of the ontology to the domain of the input data">Specialization score</th><th title="Number of annotations performed with the ontology for the input data">Annotations</th><th title="This columns makes it possible to highlight the annotations performed with each ontology" style="text-align: center">Highlight annotations</th></tr></thead>');t.append(n),t.append("<tbody>");for(var o=0;o<a.length;o++){for(var r=o+1,i="",s=0;s<a[o].coverageResult.annotations.length;s++)i+='<a target="_blank" href='+a[o].coverageResult.annotations[s].annotatedClass.links.ui+">"+a[o].coverageResult.annotations[s].text+"</a>, ";i=i.substring(0,i.length-2);var l=100*a[o].evaluationScore,c=100*a[o].coverageResult.normalizedScore,u=100*a[o].acceptanceResult.normalizedScore,d=100*a[o].detailResult.normalizedScore,p=100*a[o].specializationResult.normalizedScore,h="<tr><td>"+r+"</td><td>";$.each(a[o].ontologies,function(e){var t=1;2==_.output_type&&(t='style="color: '+rec.colors[e]+'"');var n=a[o].ontologies[e].acronym;h+="<a "+t+'" target="_blank" href='+bp_ont_link(n)+">"+n+"</a><br />"}),h+="</td>",h+='<td><div style="width:'+l.toFixed(0)+'%;" class="final-score"><span class="score-number">'+l.toFixed(1)+'</span></div></td><td><div style="width:'+c.toFixed(0)+'%;" class="result-scores"><span class="score-number">'+c.toFixed(1)+'</span></div></td><td><div style="width:'+u.toFixed(0)+'%;" class="result-scores"><span class="score-number">'+u.toFixed(1)+'</span></div></td><td><div style="width:'+d.toFixed(0)+'%;" class="result-scores"><span class="score-number">'+d.toFixed(1)+'</span></div></td><td><div style="width:'+p.toFixed(0)+'%;" class="result-scores"><span class="score-number">'+p.toFixed(1)+"</span></div></td><td>"+a[o].coverageResult.annotations.length+'</td><td><div style="text-align:center"><input style="vertical-align:middle" id="chk'+o+'" type="checkbox"/></div></tr>',t.append(h)}t.append("</tbody>"),$("#recommender-results").append(t),$("#recommenderButton").hide(),$("#insertInputLink").hide(),$("#editButton").show(),rec.checkFirst(a);for(o=0;o<a.length;o++)$("#chk"+o).click(function(){var e=$(this),t=e.attr("id").substring(3);if(e.is(":checked")){for(var n=0;n<a.length;n++)n!=t&&($("#chk"+n).prop("checked",!1),$("#chk"+n).parents(".row:first").css("background-color","white"));var o=rec.getHighlightedTerms(a,t);$("#inputTextHighlighted div.card-body").empty(),$("#inputTextHighlighted div.card-body").append(o),$("#inputTextHighlighted").show()}else e.prop("checked",!0)});$("#editButton").click(function(){rec.enableEdition()}),jQuery("#recommendations").dataTable({paging:!1,info:!1,searching:!1,order:[[0,"asc"]],columnDefs:[{targets:[2,3,4,5,6,7],orderSequence:["desc","asc"]}]})}else $("#radioOtSets").is(":checked")?$("#noResultsSets").show():$("#noResults").show()},error:function(e){$(".recommenderSpinner").hide(),$(".generalError").show(),console.log("error",e)}})}},checkFirst:function(e){var t=rec.getHighlightedTerms(e,0);$("#chk0").prop("checked",!0),$("#inputText").hide(),$("#inputTextHighlighted div.card-body").empty(),$("#inputTextHighlighted div.card-body").append(t),$("#inputTextHighlighted").show(),$("#chk0").parents(".row:first").css("background-color","#e2ebf0")}};jQuery(document).ready(function(){"recommender"===currentPathArray()[0]&&(rec.emptyInput=!0,$("#recommenderButton").click(rec.getRecommendations),$("#insertInputLink").click(rec.insertInput),$("input[name=input_type]:radio").change(function(){rec.enableEdition()}),$("input[name=output_type]:radio").change(function(){rec.enableEdition()}),$("#ontologyPicker").click(rec.enableEdition),$("#input_wc").click(rec.enableEdition),$("#input_wa").click(rec.enableEdition),$("#input_wd").click(rec.enableEdition),$("#input_ws").click(rec.enableEdition),$("#input_max_ontologies").click(rec.enableEdition),$("#input_wc").focus(rec.enableEdition),$("#input_wa").focus(rec.enableEdition),$("#input_wd").focus(rec.enableEdition),$("#input_ws").focus(rec.enableEdition),$("#input_max_ontologies").focus(rec.enableEdition),$("#inputText").click(rec.prepareForRealInput),$("#advancedOptionsLink").click(rec.showOrHideAdvancedOptions),$("#advancedOptions").hide(),$(".recommenderSpinner").hide(),$("#editButton").hide(),rec.hideErrorMessages(),jQuery("#recommender-help").on("click",bpPopWindow))}),function(d){var o=function(e,t){var r,u=this;if(r={autoclose:!1,beforeExpand:!1,afterExpand:!1,afterExpandError:!1,afterSelect:!1,afterJumpToClass:!1,timeout:999999,treeClass:"ncboTree",width:350,ncboUIURL:"http://bioportal.bioontology.org",apikey:null,ontology:null},null==(r=d.extend(r,t)).ontology)throw new Error("You must provide an ontology id for NCBO Property Tree Widget to operate");var i=e,n=d("<ul>").append(d("<li>").addClass("root")),o=d(".root",n);n.css("width",r.width),i.html(""),i.append(n),n.addClass(r.treeClass),this.formatNodes=function(e){var t=d("<span>"),c=d("<ul>");return e.sort(function(e,t){var n=e.prefLabel.toLowerCase(),o=t.prefLabel.toLowerCase();return n<o?-1:o<n?1:0}),d.each(e,function(e,t){var n=d("<li>"),o=d("<a>").attr("href",u.determineHTTPS(t["@id"])).html(t.prefLabel);o.attr("data-id",encodeURIComponent(t.id)).attr("data-label",t.label).attr("data-definition",t.definition).attr("data-parents",t.parents).attr("data-prefLabel",t.prefLabel),c.append(n.append(o));var a="undefined"!=typeof t.children&&t.hasChildren&&0==t.children.length;if(t.hasChildren&&"undefined"==typeof t.children||a){var r=d("<ul>").addClass("ajax"),i=d("<li>"),s=d("<a>").attr("href",t.links.children);n.append(r.append(i.append(s)))}else if("undefined"!=typeof t.children&&0<t.children.length){var l=u.formatNodes(t.children);n.append(l)}}),t.append(c),t.html()},this.selectClass=function(e){var t=d(n.find("a[data-id='"+e+"']"));d(n.find("a.active")[0]).removeClass("active"),t.addClass("active")},this.selectedClass=function(){var e=d(n.find("a.active")[0]);return 0==e.length?null:{id:decodeURIComponent(e.data("id")),prefLabel:e.html(),URL:e.attr("href")}},this.closeNearby=function(e){d(e).siblings().filter(".folder-open, .folder-open-last").each(function(){var e=d(">ul",this),t=this.className;this.className=t.replace("open","close"),e.hide()})},this.nodeToggle=function(e){var t=d(">ul",e);t.is(":visible")?(e.className=e.className.replace("open","close"),t.hide()):(e.className=e.className.replace("close","open"),t.show(),r.autoclose&&e.closeNearby(e),t.is(".ajax")&&e.setAjaxNodes(t,e.id))},this.setAjaxNodes=function(n,e,o,t){"function"==typeof r.beforeExpand&&r.beforeExpand(n),i.trigger("beforeExpand",n);var a=d.trim(d("a",n).attr("href"));a&&d.ajax({type:"GET",url:a,data:{apikey:r.apikey,include:"prefLabel,hasChildren",no_context:!0},crossDomain:!0,contentType:"json",timeout:r.timeout,success:function(e){var t=u.formatNodes(e.collection);n.removeAttr("class"),n.html(t),d.extend(n,{url:a}),u.setTreeNodes(n,!0),"function"==typeof r.afterExpand&&r.afterExpand(n),i.trigger("afterExpand",n),"function"==typeof o&&o(n)},error:function(){"function"==typeof r.afterExpandError&&r.afterExpandError(n),"function"==typeof t&&t(n),i.trigger("afterExpandError",n)}})},this.setTreeNodes=function(e,t){e=t?e.parent():e,d("li>a",e).addClass("text").bind("selectstart",function(){return!1}).click(function(){d(this).parent();var e=d(this);return d(".active",n).attr("class","text"),"text"==this.className&&(this.className="active"),"function"==typeof r.afterSelect&&r.afterSelect(decodeURIComponent(e.data("id")),e.text(),e),i.trigger("afterSelect",[decodeURIComponent(e.data("id")),e.text(),e]),!1}).bind("contextmenu",function(){return d(".active",n).attr("class","text"),"text"==this.className&&(this.className="active"),"function"==typeof r.afterContextMenu&&r.afterContextMenu(parent),!1}).mousedown(function(){!0,cloneNode=d(this).parent().clone();d(this).parent();return!1}),d("li",e).each(function(){var e=this.className,t=!1,n=d(">ul",this);if(0<n.size()){var o="folder-";e&&0<=e.indexOf("open")?(o+="open",t=!0):o+="close",this.className=o+(d(this).is(":last-child")?"-last":""),(!t||0<=e.indexOf("ajax"))&&n.hide(),u.setTrigger(this)}else{o="doc";this.className=o+(d(this).is(":last-child")?"-last":"")}}).before('<li class="line">&nbsp;</li>').filter(":last-child").after('<li class="line-last"></li>')},this.setTrigger=function(e){d(">a",e).before('<img class="trigger" src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" border=0>'),d(">.trigger",e).click(function(){u.nodeToggle(e)})},this.determineHTTPS=function(e){return void 0===e?e:e.replace("http:","https:"==document.location.protocol?"https:":"http:")},this.init=function(){o.html(d("<span>").html("Loading...").css("font-size","smaller")),d.ajax({url:u.determineHTTPS(r.ncboUIURL)+"/ajax/properties/tree",data:{apikey:r.apikey,ontology:r.ontology,no_context:!0},contentType:"json",crossDomain:!0,success:function(e){0<e.length?(e=d.map([e],function(e){return e}),o.html(u.formatNodes(e)),u.setTreeNodes(o,!1)):(o.html("No properties exist for this ontology"),o.css("font-size","14px").css("margin","5px")),"function"==typeof r.onInit&&r.onInit()}})}};d.fn.NCBOPropertyTree=function(n){return this.each(function(){var e=d(this);if(!e.data("NCBOPropertyTree")){var t=new o(e,n);t.init(),e.data("NCBOPropertyTree",t)}})}}(jQuery),jQuery(document).data().bp.ontChart={},jQuery(document).data().bp.ontChart.init=function(){Chart.defaults.global.scaleLabel=jQuery(document).data().bp.ont_chart.scaleLabel;var e={labels:jQuery(document).data().bp.ont_chart.visitsLabels,datasets:[{label:"Visits",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBorderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",data:jQuery(document).data().bp.ont_chart.visitsData}]},t=document.getElementById("visits_chart");if(t){var n=t.getContext("2d");new Chart(n,{type:"line",data:e,options:{responsive:!0,legend:{display:!1}}})}};var projectsTable,ontologies_array=[],findOntologyInput=document.getElementById("find_ontology");findOntologyInput&&(ontologies_array=JSON.parse(findOntologyInput.dataset.ontologynames)),jQuery(document).ready(function(){jQuery("#find_ontology").autocomplete({selectFirst:!0,data:ontologies_array,minChars:1,matchSubset:1,maxItemsToShow:20,delay:1,showResult:formatResultOntologySearch,onItemSelect:selectFindOntology}),jQuery("ul.sf-menu").superfish({animation:{height:"show"},delay:1200});var e=document.getElementById("ontology-visits-chart");if(e){var t=JSON.parse(e.dataset.ontnames),n=Object.keys(t),o=JSON.parse(e.dataset.ontnumbers),a=JSON.parse(e.dataset.ontnames),r=document.getElementById("myChart"),i=new Chart(r,{type:"horizontalBar",data:{labels:n,datasets:[{label:"Ontology Visits",data:o,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",borderWidth:1}]},options:{responsive:!0,legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,stepSize:5e3,userCallback:function(e){return numberWithCommas(e)}}}],yAxes:[{ticks:{}}]},tooltips:{enabled:!0,callbacks:{title:function(e){return lbl=a[e[0].yLabel],45<lbl.length&&(lbl=lbl.substring(0,37)+"..."),lbl+" ("+e[0].yLabel+")"},label:function(e,t){return t.datasets[0].label+": "+numberWithCommas(e.xLabel)}}},hover:{onHover:function(e){jQuery("#myChart").css("cursor",e[0]?"pointer":"default")}}}});r.onclick=function(e){var t=i.getElementsAtEvent(e);if(0<t.length){var n=t[0]._index,o=i.data.labels[n];window.location.href="/ontologies/"+o}}}}),jQuery(document).ready(function(){projectsTable=jQuery("#projects").dataTable({bAutoWidth:!1,bLengthChange:!1,bFilter:!1,bInfo:!1,bPaginate:!1,asStripClasses:["","alt"],fnDrawCallback:function(){if("Microsoft Internet Explorer"==navigator.appName){var e=new RegExp(">[ \t\r\n\x0B\f]*<","g"),t=jQuery("#projects").children("tbody").html();jQuery("#projects").children("tbody").html(t.replace(e,"><"))}}}),jQuery("#projects").css("width","100%"),jQuery("#projects").length&&new jQuery.fn.dataTable.FixedHeader(projectsTable,{header:!0}),jQuery("#projects-help").on("click",bpPopWindow)}),jQuery(document).ready(function(){jQuery("#datepicker").datepicker({dateFormat:"M d, yy"}),jQuery("#ui-datepicker-div").css("display","none"),jQuery(".fa-calendar-alt").on("click",function(){jQuery("#datepicker").datepicker("show")}),jQuery("#submission_isRemote_0").is(":checked")&&location_toggle("upload"),jQuery("#submission_isRemote_1").is(":checked")&&location_toggle("remote"),jQuery("#submission_isRemote_0").is(":checked")||jQuery("#submission_isRemote_1").is(":checked")||jQuery("#submission_isRemote_2").is(":checked")||jQuery("#submission_isRemote_0").attr("checked","checked"),jQuery("#submission_hasOntologyLanguage").change(function(){toggleOntologyFormatOptions(jQuery(this).val())}),jQuery("#submission_hasOntologyLanguage").trigger("change"),jQuery("#collapseOWLOptions").click(function(){var e=jQuery(this);e.text("Show advanced OWL options"==e.text()?"Hide advanced OWL options":"Show advanced OWL options")}),jQuery("#contacts").on("click",".add-contact",addContact),jQuery("#contacts").on("click",".remove-contact",removeContact),jQuery("#ontology_submission_form").validate({highlight:function(e){$(e).closest(".form-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error")},errorElement:"span",errorClass:"help-block error-help-block",errorPlacement:function(e,t){t.parent(".input-group").length?e.insertAfter(t.parent()):e.insertAfter(t)}})});